# Active Context

## Текущий фокус
- Формализация ключевых компонентов с помощью K framework и TLA+.
- Обеспечение высокой надежности и отказоустойчивости ETL-процессов.
- Масштабируемость и гибкость для интеграции новых поставщиков и временных срезов.
- Поддержка AI-ассистентов и автоматизация процессов.
- Соблюдение строгих стандартов типизации и документации.
- **Рефакторинг всех интерфейсов на основе централизованных Protocol (PEP 544) с абсолютной типизацией, структурированными docstring-контрактами и стратегическим размещением в рамках плоской структуры (см. PRD 3.0, Interfacing.md, Centralized Protocols).**
- **Внедрение и соблюдение единых архитектурных стандартов для всех ядровых и расширяемых компонентов (ConverterProtocol, ETLProtocol, EnrichmentProtocol и др.).**
- **Реализация гибридной стратегии управления контрактами (централизованный SSoT, локальные ссылки, автоматическая синхронизация) для поддержки работы в средах с несколькими AI-агентами и IDE.**

## Текущая бизнес-логика
- В системе различаются два ключевых типа данных:
  - **Временные срезы товарной матрицы (snapshot):** файлы, отражающие состояние ассортимента на момент выгрузки, обрабатываются изолированным ETL-потоком и сохраняются в отдельные таблицы.
  - **Сырьё (vendor data):** исходные файлы поставщиков, используемые для построения и пополнения товарного справочника (master catalog).
- Изолированные ETL-потоки обеспечивают независимую обработку и хранение временных срезов, не смешивая их с основной товарной матрицей или другими срезами.
- Это позволяет гибко управлять ассортиментом, анализировать и обновлять справочник на основе новых данных.

## Недавние изменения
- Инициализация и структурирование Memory Bank.
- Формализация целей, архитектуры и требований проекта.
- Зафиксированы ключевые архитектурные решения и их обоснование.
- Определены требования к качеству кода и интерфейсам.
- **Принятие и фиксация стандартов централизованных Protocol-интерфейсов, абсолютной типизации и структурированных контрактов (docstring) для всех компонентов.**
- **Запуск процесса поэтапного рефакторинга интерфейсов и миграции к единому архитектурному слою контрактов.**
- **Проведен анализ и уточнены стратегии применения контрактного программирования (DbC) с использованием AI и управления контрактами в сложных средах (см. отчеты в java_tools/).**
- **Внедрена система логирования на базе SLF4J и Log4j2 для улучшения диагностики и мониторинга работы конвертеров.**

## Открытые вопросы и проблемы
- Как оптимально интегрировать новые временные срезы и поставщиков с минимальными изменениями в ядре.
- Как повысить производительность при обработке больших объемов данных.
- Расширение формальных спецификаций на все критичные компоненты.
- Автоматизация тестирования формальных моделей.
- Баланс между гибкостью конфигураций и строгой валидацией данных.
- **Как обеспечить полное покрытие всех компонентов централизованными Protocol-интерфейсами и структурированными контрактами.**
- **Какие сложности и компромиссы возникают при миграции к плоской структуре и стратегическому размещению интерфейсов.**
- **Как автоматизировать контроль соблюдения новых стандартов (типизация, docstring, архитектурные требования) на уровне CI/CD.**
- **Как эффективно реализовать и поддерживать автоматическую синхронизацию между центральным репозиторием контрактов и локальными ссылками/копиями в модулях?**
- **Какие инструменты оптимальны для управления символическими ссылками и проверки консистентности контрактов в CI/CD?**
- **Как интегрировать AI-ассистентов с гибридной системой управления контрактами для автоматического обнаружения и использования релевантных контрактов?**
- **Как расширить систему логирования для интеграции с системами мониторинга и аналитики в реальном времени?**

---

## Синтез и инсайты (Synthesis & Insights)
_Агрегация и обобщение ключевых знаний, выводов и паттернов, выявленных в ходе работы. Заполняется вручную или автоматически по итогам ретроспектив, анализа логов и обратной связи._

- [ ] (Пример) Синтез: Внедрение централизованных Protocol-интерфейсов ускорило интеграцию новых поставщиков.
- [ ] (Пример) Инсайт: Формальные спецификации выявили неочевидные ошибки в бизнес-логике.
- [ ] Синтез: Эффективное использование AI для генерации/проверки кода требует надежной и доступной системы управления контрактами (API, схемы данных).
- [ ] Инсайт: Гибридный подход к управлению контрактами (центральный SSoT + локальные ссылки + автосинхронизация) является ключевым для поддержки совместной работы людей и AI-агентов в сложных проектах.
- [ ] Синтез: Внедрение системы логирования с использованием MDC (контекстное логирование) значительно упрощает диагностику проблем в сложных процессах обработки данных.
- [ ] Инсайт: Логирование использования памяти и производительности позволяет выявлять узкие места и оптимизировать критические пути выполнения.

---

## Контрактное программирование

Проект использует гибридную стратегию управления контрактами (#DECISION_ID_HYBRID_CONTRACTS). Ключевые документы:

- Основной отчет: [@java_tools\revised_detailed_contract_programming_analysis_report.md](../java_tools/revised_detailed_contract_programming_analysis_report.md)
- Рабочие процессы: [@Docs\contract_management_workflows.md](../Docs/contract_management_workflows.md)
- Дополнительные материалы:
  - [@java_tools\(лог-с-DeepSeek)-Контрактное-программирование-ИИ.md](../java_tools/(лог-с-DeepSeek)-Контрактное-программирование-ИИ.md)
  - [@java_tools\(лог-Grok)-контрактное-программирование.md](../java_tools/(лог-Grok)-контрактное-программирование.md)
- Документы по дедупликации и нормализации:
  - [@java_tools\SOTA_(Главный)_Дедупликация_товарных_данных.md](../java_tools/SOTA_(Главный)_Дедупликация_товарных_данных.md)
  - [@java_tools\SOTA_(пункт1)_Нормализация.md](../java_tools/SOTA_(пункт1)_Нормализация.md)
  - [@java_tools\SOTA_(Пункт2)_Сортировка_и_блокировка.md](../java_tools/SOTA_(Пункт2)_Сортировка_и_блокировка.md)

Для централизованного управления контрактами создан файл [contracts.md](./contracts.md) в Memory Bank.

---

## Кросс-ссылки (Cross-References)
_Связи с решениями, событиями, изменениями и внешними документами. Используйте ID, теги или прямые ссылки на связанные записи в decisionLog.md, progress.md, productContext.md, PRD и др._

- [ ] (Пример) См. решение #2025-04-11-01 в decisionLog.md о внедрении Protocol-интерфейсов.
- [ ] (Пример) Связано с задачей в progress.md от 2025-04-10.
- [ ] См. отчеты анализа логов [@java_tools\(лог-с-DeepSeek)-Контрактное-программирование-ИИ.md](../java_tools/(лог-с-DeepSeek)-Контрактное-программирование-ИИ.md) и [@java_tools\(лог-Grok)-контрактное-программирование.md](../java_tools/(лог-Grok)-контрактное-программирование.md).
- [ ] См. итоговый отчет [@java_tools\revised_detailed_contract_programming_analysis_report.md](../java_tools/revised_detailed_contract_programming_analysis_report.md).
- [ ] Связано с решением #DECISION_ID_HYBRID_CONTRACTS в decisionLog.md (ID будет добавлен после обновления decisionLog).
- [ ] См. документацию по системе логирования в [logging-system.md](./logging-system.md).
- [ ] См. журнал проблем и принятых решений в [issues-and-decisions.md](./issues-and-decisions.md).

---

## Обратная связь и ретроспектива (Feedback & Retrospective)
_Фиксация обратной связи от участников, результатов ретроспектив, а также выявленных аномалий и предложений по улучшению._

- [ ] (Пример) Обратная связь: Необходима автоматизация проверки docstring-контрактов.
- [ ] (Пример) Итог ретроспективы: Требуется регулярный аудит кросс-ссылок.

---

## Мета-работа и эволюция ролей (Meta-Work & Role Evolution)
_Документирование изменений в процессах, инструментах, распределении ролей и ответственности. Используйте шаблон:_

- [ ] (Дата, инициатор) Описание изменения/инициативы, причина, ожидаемый эффект.
- [ ] (Пример) 2025-04-11, Архитектор: Введён шаблон для кросс-ссылок, ожидается повышение связности знаний.

---

## Регулярный аудит и кураторство (Review & Curation)
_Назначьте ответственных и периодичность аудита для предотвращения фрагментации и устаревания знаний._

- [ ] Ответственный: Архитектор. Периодичность: не реже одного раза в месяц.
- [ ] Задачи: аудит кросс-ссылок, синтеза, обратной связи, а также обязательная сверка документации с текущими архитектурными стандартами (Protocols, типизация, CI/CD).
- [ ] Важно: Регулярный аудит необходим для предотвращения устаревания документации и поддержания её соответствия коду и стандартам проекта.
