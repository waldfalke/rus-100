# Product Context

## Назначение и цели
- CATMEPIM — система управления каталогами и PIM.
- Обеспечивает обработку, нормализацию и загрузку данных от поставщиков.
- Ориентирована на высокую надежность, производительность и гибкость.
- Поддерживает формальные спецификации (K framework, TLA+).
- Проект ориентирован на интеграцию с AI-ассистентами.

## Ключевые понятия
- **Временной срез товарной матрицы (snapshot):** файл, предоставленный пользователем (например, fast_export.xls), отражающий состояние ассортимента на момент выгрузки. Обрабатывается изолированным ETL-потоком и сохраняется в отдельные таблицы.
- **Справочник (master catalog):** централизованный товарный справочник, формируемый и пополняемый на основе данных от разных вендоров.
- **Сырьё (vendor data):** исходные файлы поставщиков, используемые для построения и пополнения справочника.

## Основные функции и модули
- ETL: извлечение, трансформация, загрузка данных.
- Конфигурации поставщиков в формате YAML/JSON.
- Управление и версиями конфигураций.
- Работа с базой данных PostgreSQL.
- Механизмы многоуровневой отказоустойчивости.
- Поддержка формальных спецификаций для верификации.

## Архитектура и реализация
- Модульная, расширяемая ETL-система.
- Основные слои:
  - **core** — модели данных.
  - **etl** — реализация ETL-процессов.
  - **config** — управление конфигурациями.
- Используются современные паттерны: dataclass, Protocol, фабрики.
- Поддержка форматов Excel, CSV, JSON.
- Буферизация, чекпоинты, потоковая обработка.
- Валидация, очистка, дедупликация данных.
- Масштабируемость и расширяемость для новых поставщиков и временных срезов.
- **Вся архитектура строится на централизованных Protocol-интерфейсах (PEP 544), с абсолютной типизацией, структурированными docstring-контрактами (Google Style) и стратегическим размещением интерфейсов в рамках плоской структуры.**
- **Стандарты и требования зафиксированы в PRD 3.0 (AI-Centric, Consolidated), Interfacing.md и Centralized Protocols.**
- **Контракты охватывают все ядровые и расширяемые компоненты (ConverterProtocol, ETLProtocol, EnrichmentProtocol и др.), обеспечивая единый, расширяемый и AI-дружелюбный API слой.**
## Технологии и инструменты
- Язык: Python.
- Библиотеки: Pandas, pyarrow, orjson, polars, ijson.
- База данных: PostgreSQL.

---
[2025-04-11 18:24:05] - Archive Directory Policy / Политика директории Archive

All files in the `Archive` directory (for example, `Archive/converter.py`, `Archive/some_json_converter.py`, and similar) are strictly informational and serve as legacy/reference code. These files must NOT be executed, imported, or used as active code in any way unless the user gives explicit instructions to do so. Do not attempt to run, test, or otherwise utilize `Archive/*.py` files as part of the current codebase without direct user authorization.

Все файлы в директории `Archive` (например, `Archive/converter.py`, `Archive/some_json_converter.py` и подобные) служат исключительно источником информации (референс/наследие). Запускать, импортировать или использовать их как активный код запрещено без прямого указания пользователя. Не пытайтесь запускать, тестировать или каким-либо образом использовать `Archive/*.py` как часть текущей кодовой базы без явного разрешения пользователя.
