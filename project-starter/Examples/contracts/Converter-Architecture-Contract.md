# Архитектурный контракт: Converter

## Метаданные
- **Версия**: 1.0.0
- **Статус**: Стабильный
- **Последнее обновление**: 2025-04-15
- **Последний редактор**: AI

## Описание
Модуль Converter отвечает за преобразование Excel-файлов в JSON-формат. Он является первым компонентом ETL-процесса, обеспечивающим извлечение данных из исходных файлов и их подготовку для дальнейшей обработки.

## Место в архитектуре системы

```
[Excel-файлы] → Converter → [JSON-данные] → Deduplicator → [Уникальные JSON-данные] → DatabaseLoader → [База данных]
```

## Ответственности

### Что входит в зону ответственности
- Определение поставщика (вендора) на основе имени файла или его содержимого
- Преобразование Excel-файлов в CSV-формат
- Преобразование CSV-данных в JSON-формат
- Оптимизация JSON-данных (удаление пустых полей, нормализация значений)
- Сохранение результата в файл или предоставление потока JSON-объектов
- Логирование процесса конвертации и возникающих ошибок

### Что НЕ входит в зону ответственности
- Валидация данных (это задача Validator)
- Дедупликация данных (это задача Deduplicator)
- Загрузка данных в базу данных (это задача DatabaseLoader)
- Обогащение данных (это задача Enricher)

## Входные данные
- Excel-файл (форматы XLSX, XLS)
- Конфигурация с настройками конвертации (опционально)

## Выходные данные
- Поток JSON-объектов или JSON-файл, содержащий данные из Excel-файла
- Метаданные о процессе конвертации (количество обработанных строк, время выполнения и т.д.)

## Алгоритм работы
1. **Определение вендора**: анализ имени файла или его содержимого для определения поставщика данных
2. **Преобразование Excel в CSV**: чтение Excel-файла и преобразование его в CSV-формат
3. **Преобразование CSV в JSON**: чтение CSV-данных и преобразование их в JSON-формат
4. **Оптимизация JSON**: удаление пустых полей, нормализация значений, оптимизация структуры
5. **Сохранение результата**: сохранение JSON-данных в файл или предоставление их в виде потока объектов

## Взаимодействие с другими модулями

### Исходящие зависимости
- **Deduplicator**: получает данные от Converter для дедупликации

## Конфигурация
Модуль Converter должен поддерживать конфигурацию следующих параметров:
- Кодировка входного файла
- Разделитель для CSV-формата
- Имя листа Excel для обработки
- Размер чанка для обработки больших файлов
- Флаг сжатия выходных данных (gzip)
- Флаг форматирования JSON (pretty print)

## Метрики и мониторинг
- Количество обработанных строк
- Время выполнения каждого этапа конвертации
- Размер входного и выходного файла
- Количество ошибок при конвертации

## Ограничения и требования
- Модуль должен эффективно работать с большими файлами (до 1-2 ГБ)
- Модуль должен обрабатывать различные форматы Excel (XLSX, XLS)
- Модуль должен корректно обрабатывать кириллические символы
- Модуль должен быть расширяемым для поддержки новых форматов и вендоров

## Примеры использования

```java
// Пример использования Converter в ETL-процессе
File excelFile = new File("input.xlsx");
Converter converter = new ExcelConverter();
Deduplicator deduplicator = new EnhancedDeduplicator(config);
DatabaseLoader loader = new PostgreSQLLoader(dbConfig);

// Конвертация Excel в JSON
Stream<JSONObject> jsonData = converter.convert(excelFile);

// Дедупликация данных
Stream<JSONObject> uniqueData = deduplicator.deduplicate(jsonData);

// Загрузка уникальных данных в базу данных
loader.loadData(uniqueData);
```

## Связанные контракты
- [Converter Interface Contract](./interfaces/converter/contract.md)
- [Deduplicator Architecture Contract](./Deduplicator-Architecture-Contract.md)
- [DatabaseLoader Architecture Contract](./DatabaseLoader-Architecture-Contract.md)
- [JSON Schema](./data/json-schema/converter-output-schema.json)
