# Контракт: Схема базы данных CATMEPIM

## Метаданные
- **Версия**: 1.0.0
- **Статус**: Актуальный
- **Последнее обновление**: 2025-04-20
- **Последний редактор**: AI
- **Ветка разработки**: main

## История изменений
| Дата | Версия | Автор | Описание изменений | PR |
|------|--------|-------|-------------------|-----|
| 2025-04-20 | 1.0.0 | AI | Начальная версия | - |

## Описание
Этот документ определяет контракт для схемы базы данных системы CATMEPIM. Текущая схема базы данных использует PostgreSQL с JSONB для гибкого хранения данных о продуктах.

## Текущая структура базы данных

### Основные таблицы
- **products** - основная таблица для хранения данных о продуктах (книгах) в формате JSONB

### Представления
- **products_view** - представление для удобного доступа к часто используемым полям

### Индексы
- **idx_products_data** - GIN индекс для ускорения поиска по JSONB
- **idx_products_artikul** - индекс по полю "Артикул"
- **idx_products_category** - индекс по полю "Категория"
- **idx_products_brand** - индекс по полю "Бренд"
- **idx_products_isbn** - индекс по полю "ИСБН"
- **idx_products_name** - индекс по полю "Название"

### Триггеры
- **update_products_updated_at** - автоматическое обновление поля updated_at при изменении записи

## Инварианты базы данных
- Каждая запись должна иметь уникальный идентификатор (id)
- Поле data должно содержать валидный JSON
- Поля created_at и updated_at должны содержать корректные временные метки
- Поле updated_at должно автоматически обновляться при изменении записи

## Планируемые изменения
Согласно спецификации в [data-data-base-base.md](../../java_tools/data-data-base-base.md), планируется расширение схемы для поддержки:
- Нормализованного хранения данных о книгах, авторах, издательствах
- Управления прайс-листами от поставщиков
- Отслеживания изменений и происхождения данных

См. файлы отдельных объектов базы данных для детальных DDL-контрактов:
- [products.sql](./products.sql) - таблица products (существующая реализация)
- [views.sql](./views.sql) - представления
- [triggers.sql](./triggers.sql) - триггеры и функции

## Связанные контракты
- [DatabaseLoader Interface Contract](../interfaces/database-loader/contract.md)
- [DatabaseLoader Architecture Contract](../DatabaseLoader-Architecture-Contract.md)
- [ETL Process Contract](../ETL-Process-Contract.md) 