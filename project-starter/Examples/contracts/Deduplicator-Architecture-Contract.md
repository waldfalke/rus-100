# Архитектурный контракт: Deduplicator

## Метаданные
- **Версия**: 1.0.0
- **Статус**: Стабильный
- **Последнее обновление**: 2025-04-15
- **Последний редактор**: AI

## Описание
Модуль Deduplicator отвечает за выявление и удаление дубликатов в данных о товарах. Он является ключевым компонентом ETL-процесса, обеспечивающим качество данных перед их загрузкой в базу данных.

## Место в архитектуре системы

```
[Excel-файлы] → Converter → [JSON-данные] → Deduplicator → [Уникальные JSON-данные] → DatabaseLoader → [База данных]
```

## Ответственности

### Что входит в зону ответственности
- Выявление дубликатов в данных на основе различных критериев (точное и нечеткое сравнение)
- Удаление или объединение дубликатов согласно настроенным правилам
- Логирование информации о найденных дубликатах
- Предоставление статистики о процессе дедупликации

### Что НЕ входит в зону ответственности
- Преобразование форматов данных (это задача Converter)
- Валидация данных (это задача Validator)
- Загрузка данных в базу данных (это задача DatabaseLoader)
- Обогащение данных (это задача Enricher)

## Входные данные
- Поток JSON-объектов или JSON-файл, содержащий данные о товарах
- Конфигурация с настройками алгоритмов дедупликации

## Выходные данные
- Поток JSON-объектов или JSON-файл, содержащий только уникальные записи
- Статистика о процессе дедупликации (количество найденных дубликатов, время выполнения и т.д.)

## Алгоритм работы
1. **Нормализация данных**: приведение данных к единому формату для корректного сравнения
2. **Блокировка (Blocking)**: группировка записей по определенным критериям для уменьшения количества сравнений
3. **Точное сравнение**: выявление дубликатов на основе точного совпадения ключевых полей (ISBN, артикул)
4. **Нечеткое сравнение**: выявление дубликатов на основе нечеткого сравнения текстовых полей (название, описание)
5. **Объединение результатов**: формирование итогового списка дубликатов
6. **Удаление или объединение дубликатов**: в зависимости от настроек

## Взаимодействие с другими модулями

### Входящие зависимости
- **Converter**: предоставляет данные для дедупликации
- **ConfigurationLoader**: предоставляет конфигурацию для алгоритмов дедупликации

### Исходящие зависимости
- **DatabaseLoader**: получает уникальные данные для загрузки в базу данных

## Конфигурация
Модуль Deduplicator должен поддерживать конфигурацию следующих параметров:
- Пороги сходства для нечеткого сравнения
- Поля, используемые для точного сравнения
- Поля, используемые для нечеткого сравнения
- Стратегия обработки дубликатов (удаление, объединение)

## Метрики и мониторинг
- Количество обработанных записей
- Количество найденных дубликатов
- Время выполнения каждого этапа дедупликации
- Процент дубликатов от общего количества записей

## Ограничения и требования
- Модуль должен эффективно работать с большими объемами данных
- Модуль должен быть расширяемым для добавления новых алгоритмов дедупликации
- Модуль должен обеспечивать баланс между точностью и производительностью

## Примеры использования

```java
// Пример использования Deduplicator в ETL-процессе
Converter converter = new ExcelConverter();
Deduplicator deduplicator = new EnhancedDeduplicator(config);
DatabaseLoader loader = new PostgreSQLLoader(dbConfig);

// Конвертация Excel в JSON
Stream<JSONObject> jsonData = converter.convert(excelFile);

// Дедупликация данных
Stream<JSONObject> uniqueData = deduplicator.deduplicate(jsonData);

// Загрузка уникальных данных в базу данных
loader.loadData(uniqueData);
```

## Связанные контракты
- [Converter Interface Contract](./interfaces/converter/contract.md)
- [DatabaseLoader Interface Contract](./interfaces/database-loader/contract.md)
- [Deduplicator Interface Contract](./interfaces/deduplicator/contract.md)
- [JSON Schema](./data/json-schema/input-schema.json)
