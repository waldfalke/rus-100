# Контракт системы CATMEPIM

## Метаданные
- **Версия**: 1.0.0
- **Статус**: Стабильный
- **Последнее обновление**: 2025-04-15
- **Последний редактор**: AI
- **Ветка разработки**: main

## История изменений
| Дата | Версия | Автор | Описание изменений | PR |
|------|--------|-------|-------------------|-----|
| 2025-04-15 | 1.0.0 | AI | Начальная версия | - |

## Назначение и миссия системы

CATMEPIM (Catalog Management and Enterprise Product Information Management) — это система управления информацией о товарах, предназначенная для создания, хранения и управления эталонными данными (Архетипами) о товарах для магазина "Кот Учёный". 

Миссия системы — обеспечить единый источник правды о товарах, повысить качество данных и упростить процесс управления ассортиментом магазина.

## Основные бизнес-цели

1. **Создание эталонных данных (Архетипов)** — формирование и поддержание базы эталонных записей о товарах на основе данных из различных источников.
2. **Повышение качества данных** — очистка, нормализация и обогащение данных о товарах для обеспечения их полноты, точности и актуальности.
3. **Упрощение управления ассортиментом** — предоставление инструментов для эффективного управления ассортиментом магазина.
4. **Аналитика данных** — обеспечение возможности анализа данных о товарах для принятия обоснованных бизнес-решений.
5. **Интеграция с внешними системами** — обеспечение возможности обмена данными с другими системами магазина.

## Ключевые процессы

### 1. Загрузка данных
- Загрузка данных из Excel-файлов от различных поставщиков
- Автоматическое определение поставщика и формата данных
- Поддержка больших файлов через потоковую обработку и адаптивное разбиение

### 2. Обработка и нормализация данных
- Очистка данных от некорректных значений
- Нормализация данных в соответствии с установленными правилами
- Дедупликация для устранения дублирующихся записей
- Валидация данных на соответствие схемам

### 3. Создание и управление Архетипами
- Формирование эталонных записей (Архетипов) на основе обработанных данных
- Обновление существующих Архетипов при поступлении новых данных
- Версионирование Архетипов для отслеживания изменений

### 4. Обогащение данных
- Добавление дополнительной информации о товарах из внешних источников
- Обогащение данных метаданными для улучшения поиска и категоризации
- Генерация дополнительных атрибутов на основе существующих данных

### 5. Анализ данных
- Выявление трендов в данных о товарах
- Обнаружение аномалий и потенциальных проблем
- Генерация аналитических отчетов для принятия бизнес-решений

### 6. Экспорт данных
- Экспорт обработанных данных в формате Excel для использования в магазине
- Поддержка различных форматов экспорта (JSON, CSV, XML)
- Настраиваемые шаблоны экспорта для различных целей

## Архитектурные компоненты

### 1. ETL-процесс
- **Извлечение (Extract)** — загрузка данных из различных источников
- **Преобразование (Transform)** — обработка, нормализация и обогащение данных
- **Загрузка (Load)** — сохранение обработанных данных в базе данных

### 2. Конвертеры
- **ExcelToJsonConverter** — конвертация Excel-файлов в JSON-формат
- **JsonCleaner** — очистка и нормализация JSON-данных
- **Другие конвертеры** — для работы с различными форматами данных

### 3. Детекторы поставщиков
- **VendorDetector** — определение поставщика на основе имени файла и содержимого
- **VendorConfig** — конфигурация для работы с различными поставщиками

### 4. Дедупликаторы
- **Deduplicator** — устранение дублирующихся записей
- **Алгоритмы дедупликации** — точное и нечеткое сопоставление записей

### 5. Обогатители данных
- **DataEnricher** — обогащение данных дополнительной информацией
- **Источники обогащения** — внешние API, базы данных, алгоритмы генерации

### 6. Аналитические инструменты
- **DataAnalyzer** — анализ данных для выявления трендов и аномалий
- **ReportGenerator** — генерация аналитических отчетов

### 7. База данных
- **PostgreSQL** — хранение эталонных данных и метаданных
- **JSONB** — хранение структурированных данных в гибком формате

## Интерфейсы системы

### 1. Входные интерфейсы
- **Файловый интерфейс** — загрузка Excel-файлов от поставщиков
- **API** — программный интерфейс для загрузки данных из других систем

### 2. Выходные интерфейсы
- **Файловый интерфейс** — экспорт данных в различных форматах
- **API** — программный интерфейс для получения данных другими системами
- **Отчеты** — генерация аналитических отчетов

### 3. Пользовательские интерфейсы
- **Веб-интерфейс** — управление системой через браузер
- **Командная строка** — управление системой через командную строку

## Предусловия и постусловия

### Предусловия
- Наличие данных о товарах в формате Excel от поставщиков
- Доступность базы данных PostgreSQL
- Наличие необходимых вычислительных ресурсов для обработки данных

### Постусловия
- Создание и поддержание актуальной базы эталонных данных (Архетипов) о товарах
- Возможность экспорта обработанных данных для использования в магазине
- Наличие аналитической информации для принятия бизнес-решений

## Инварианты
- Система должна обеспечивать целостность и непротиворечивость данных
- Система должна обеспечивать идемпотентность операций обработки данных
- Система должна обеспечивать прослеживаемость происхождения данных
- Система должна обеспечивать масштабируемость при увеличении объема данных
- Система должна обеспечивать отказоустойчивость и восстановление после сбоев

## Исключения и обработка ошибок
- **Ошибки загрузки данных** — логирование, уведомление пользователя, возможность повторной загрузки
- **Ошибки обработки данных** — логирование, частичная обработка, возможность ручной коррекции
- **Ошибки базы данных** — логирование, откат транзакций, автоматическое восстановление
- **Системные ошибки** — логирование, автоматический перезапуск, уведомление администратора

## Примеры использования

### Пример 1: Загрузка и обработка данных от поставщика
```
1. Пользователь загружает Excel-файл от поставщика через веб-интерфейс
2. Система автоматически определяет поставщика и формат данных
3. Система конвертирует Excel-файл в JSON-формат
4. Система очищает и нормализует данные
5. Система выполняет дедупликацию для устранения дублирующихся записей
6. Система обогащает данные дополнительной информацией
7. Система создает или обновляет Архетипы в базе данных
8. Система генерирует отчет о результатах обработки
9. Пользователь получает уведомление о завершении обработки
```

### Пример 2: Экспорт данных для магазина
```
1. Пользователь запрашивает экспорт данных через веб-интерфейс
2. Система формирует запрос к базе данных для получения актуальных Архетипов
3. Система генерирует Excel-файл с данными в соответствии с выбранным шаблоном
4. Система предоставляет пользователю ссылку для скачивания файла
5. Пользователь скачивает файл и использует его в магазине
```

### Пример 3: Анализ данных для принятия бизнес-решений
```
1. Пользователь запрашивает аналитический отчет через веб-интерфейс
2. Система выполняет анализ данных с использованием выбранных алгоритмов
3. Система генерирует отчет с выявленными трендами, аномалиями и рекомендациями
4. Система предоставляет пользователю отчет в выбранном формате
5. Пользователь использует отчет для принятия бизнес-решений
```

## Связанные контракты
- [ETL Process Contract](./contracts/ETL-Process-Contract.md)
- [Converter Interface Contract](./contracts/interfaces/converter/contract.md)
- [Deduplicator Interface Contract](./contracts/interfaces/deduplicator/contract.md)
- [DatabaseLoader Interface Contract](./contracts/interfaces/database-loader/contract.md)
- [DataAnalyzer Interface Contract](./contracts/interfaces/data-analyzer/contract.md)
- [DataEnricher Interface Contract](./contracts/interfaces/enricher/data-enricher.md)
- [VendorDetector Contract](./contracts/interfaces/converter/vendor-detector.md)
- [ExcelToJsonConverter Contract](./contracts/interfaces/converter/excel-to-json-converter.md)
- [JsonCleaner Contract](./contracts/interfaces/converter/json-cleaner.md)
