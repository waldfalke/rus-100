# UX Контракт: Панель с вкладками

## Метаданные
- **Версия**: 1.0.0
- **Статус**: В разработке
- **Последнее обновление**: 2023-05-23
- **Последний редактор**: AI

## Назначение
Компонент панели с вкладками предоставляет удобный интерфейс для переключения между различными разделами генератора тестов ЕГЭ. Панель позволяет пользователю легко переходить между этапами создания теста, просмотра результатов и управления заданиями.

### Preconditions
- **Для компонента панели вкладок:**
    - Массив вкладок (`tabs`) должен быть определен, каждая вкладка должна иметь `id`, `name`, `icon`, `content` и опционально `disabled`.
    - Должна быть передана функция (`setCurrentTab`) для обновления состояния активной вкладки.
    - Должно быть передано текущее состояние активной вкладки (`currentTab`).
- **Для структуры данных (`test-content.ts`):**
    - Файл `test-content.ts` должен существовать и экспортировать массивы `tasksData`, `egeFormatData`, `exercisesData`.
    - Все типы (`DifficultyType`, `TestItem`, etc.) должны быть корректно определены.
    - Все `id` заданий (`TestItem.id`) должны быть уникальными в пределах всего набора данных.
    - Значения `difficultyType` должны соответствовать одному из: "none", "easy", "hard", "both".
    - Начальные `count` должны быть 0, `maxCount` - положительным числом (или `undefined` для дефолтного).

### Postconditions
- **При взаимодействии с панелью вкладок:**
    - При клике на активную, не отключенную вкладку, ее `id` передается в `setCurrentTab`, состояние `currentTab` обновляется.
    - Отображается `content`, соответствующий новому `currentTab`.
    - Предыдущая активная вкладка становится неактивной.
    - Состояние активной вкладки сохраняется между рендерами (управляется родительским компонентом).
- **При использовании данных (`test-content.ts`):**
    - Данные о заданиях успешно импортируются и доступны в `TestGenerator`.
    - Структура данных позволяет рендерить карточки заданий для всех трех режимов (вкладок).

### Invariants
- **Состояние панели вкладок:**
    - Всегда активна **ровно одна** вкладка (ее `id` соответствует `currentTab`).
    - Порядок вкладок остается неизменным.
    - Отключенные вкладки (`disabled=true`) не могут быть активированы кликом.
    - Атрибуты доступности (`role`, `aria-...`) всегда корректно отражают состояние вкладок.
- **Структура данных (`test-content.ts`):**
    - Уникальность `id` заданий сохраняется.
    - Каждое задание принадлежит ровно одной категории в рамках своего типа данных (`tasksData`, `egeFormatData`, `exercisesData`).
    - Значения `difficultyType` всегда валидны.
    - Связь между `id` вкладки и используемым набором данных (`tasksData`, `egeFormatData`, `exercisesData`) остается консистентной.

### Exceptions
- **Ошибка конфигурации вкладок:** Передан некорректный массив `tabs` (дублирующиеся `id`, отсутствие `content`).
- **Ошибка состояния:** Не передана функция `setCurrentTab` или состояние `currentTab`.
- **Ошибка данных:** Файл `test-content.ts` отсутствует, содержит ошибки синтаксиса, невалидные данные (неуникальные `id`, некорректные `difficultyType`).
- **Ошибка рендеринга контента:** Компонент, переданный в `tab.content`, вызывает ошибку при рендеринге.
- **Нарушение доступности:** Некорректная установка ARIA-атрибутов или отсутствие поддержки клавиатурной навигации.
- **Проблемы адаптивности:** Некорректное отображение на мобильных устройствах (например, если не предусмотрен режим выпадающего списка).

## Визуальное представление
Компонент представляет собой горизонтальную панель с вкладками в верхней части интерфейса. Каждая вкладка содержит иконку и текстовую метку. Активная вкладка визуально выделяется для обозначения текущего раздела. Содержимое активной вкладки отображается ниже панели.

Основные визуальные элементы используют следующие Tailwind классы:
- Контейнер панели: `border-b border-gray-200`
- Список вкладок: `flex -mb-px space-x-8`
- Неактивная вкладка: `py-4 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300`
- Активная вкладка: `py-4 px-1 border-b-2 border-indigo-500 text-sm font-medium text-indigo-600`
- Иконка вкладки: `mr-2 h-5 w-5`
- Содержимое вкладки: `py-6`

## Состояния
- **Вкладка — неактивная**: `text-gray-500 border-transparent`
- **Вкладка — при наведении**: `text-gray-700 border-gray-300`
- **Вкладка — активная**: `text-indigo-600 border-indigo-500`
- **Вкладка — отключенная**: `text-gray-400 cursor-not-allowed`
- **Вкладка — следующий шаг**: Отображает индикатор, что данный шаг следует за текущим
- **Вкладка — предыдущий шаг**: Отображает индикатор, что данный шаг предшествует текущему

## Поведение
- Клик по вкладке активирует соответствующую вкладку и отображает её содержимое
- Активная вкладка визуально выделяется
- Отключенные вкладки не реагируют на клик
- Переходы между вкладками могут иметь плавную анимацию
- При переходе на новую вкладку текущий этап работы сохраняется
- Вкладки могут отображать индикатор состояния (например, завершенность этапа)

## Доступность
- Вкладки имеют атрибуты `role="tab"` и `aria-selected="true/false"` для обозначения активности
- Панель с вкладками имеет атрибут `role="tablist"`
- Содержимое вкладок имеет атрибут `role="tabpanel"`
- Вкладки и панели связаны атрибутами `aria-controls` и `id`
- Навигация между вкладками доступна с клавиатуры (Tab и Arrow keys)
- Отключенные вкладки имеют атрибут `aria-disabled="true"`

## Адаптивность
- На мобильных устройствах иконки становятся более компактными
- При необходимости текст вкладок сокращается или заменяется на иконки
- На очень маленьких экранах вкладки могут отображаться как выпадающий список
- При прокрутке панель с вкладками может фиксироваться вверху экрана
- Используется адаптивная система отступов в зависимости от ширины экрана

## Примеры использования
```jsx
// Пример разметки панели с вкладками
<div>
  <div className="border-b border-gray-200">
    <nav className="-mb-px flex space-x-8" aria-label="Tabs">
      {tabs.map((tab) => (
        <button
          key={tab.name}
          onClick={() => setCurrentTab(tab.id)}
          className={classNames(
            tab.id === currentTab
              ? 'border-indigo-500 text-indigo-600'
              : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300',
            'py-4 px-1 border-b-2 font-medium text-sm flex items-center',
            tab.disabled ? 'cursor-not-allowed opacity-50' : ''
          )}
          disabled={tab.disabled}
          aria-current={tab.id === currentTab ? 'page' : undefined}
          role="tab"
          aria-selected={tab.id === currentTab}
          aria-controls={`panel-${tab.id}`}
          aria-disabled={tab.disabled}
        >
          <tab.icon className="mr-2 h-5 w-5" aria-hidden="true" />
          {tab.name}
        </button>
      ))}
    </nav>
  </div>
  <div>
    {tabs.map((tab) => (
      <div
        key={`panel-${tab.id}`}
        id={`panel-${tab.id}`}
        role="tabpanel"
        aria-labelledby={tab.id}
        className={tab.id === currentTab ? 'py-6' : 'hidden'}
      >
        {tab.content}
      </div>
    ))}
  </div>
</div>
```

## Структура данных
```typescript
// Структура данных для вкладки "По заданиям"
export const tasksData: TestCategory[] = [
  {
    category: "Работа с текстом",
    items: [
      {
        id: 1,
        title: "№1. Средства связи предложений в тексте",
        count: 0,
        difficulty: "both",
        difficultyType: "both",
        maxCount: 10,
      },
      // ... другие задания
    ],
  },
  // ... другие категории
];

// Структура данных для вкладки "ЕГЭ"
export const egeFormatData: EGESection[] = [
  {
    title: "Часть 1",
    categories: [
      {
        title: "Работа с текстом",
        items: [
          // ... задания
        ],
      },
      // ... другие категории
    ],
  },
  // ... другие разделы
];

// Структура данных для вкладки "Упражнения"
export const exercisesData: EGESection[] = [
  {
    title: "Орфография",
    categories: [
      {
        title: "Правописание приставок",
        items: [
          // ... задания
        ],
      },
      // ... другие категории
    ],
  },
  // ... другие разделы
];
```

## Примеры использования
```typescript
// Импорт данных в компоненте TestGenerator
import { tasksData, egeFormatData, exercisesData } from "@/data/test-content";

// Инициализация состояния в компоненте
const [tasksDataState, setTasksDataState] = useState(tasksData);
const [egeFormatDataState, setEgeFormatDataState] = useState(egeFormatData);
const [exercisesDataState, setExercisesDataState] = useState(exercisesData);
```

## Связанные контракты
- [Контракт компонента: TestGenerator](./Component-TestGenerator.md)
- [UX Контракт: Карточка задания](./UX-TaskCard.md)
- [UX Контракт: Раздел категории заданий](./UX-CategorySection.md)
- [UX Контракт: Индикатор прогресса](./UX-ProgressIndicator.md) 
- [Исправление бага: Размеры панели с вкладками](./bugfixes/TabPanel-Size-Bugfix-Contract.md) 