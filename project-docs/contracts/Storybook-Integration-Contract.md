# Контракт на внедрение Storybook и организацию библиотеки компонентов

## 1. Цели и задачи

- Внедрить Storybook как стандартную среду для изолированной разработки, тестирования и документирования UI-компонентов проекта.
- Обеспечить возможность быстрого просмотра, тестирования и сравнения разных реализаций компонентов без необходимости интеграции в основной сайт.
- Организовать хранение документации и контрактов компонентов рядом с их исходным кодом.
- Автоматизировать сборку и деплой Storybook для доступа всей команды и проведения коридорного тестирования.

## 2. Область действия

Данный контракт распространяется на:
- Внедрение и настройку Storybook для проекта на Next.js + TypeScript.
- Организацию структуры библиотеки компонентов.
- Описание взаимодействия с Storybook для разработчиков, тестировщиков и других участников процесса.
- Автоматизацию сборки и деплоя Storybook.
- Хранение и отображение документации и контрактов компонентов.

## 3. Требования к внедрению Storybook

### 3.1. Установка и базовая настройка
- Storybook должен быть установлен как dev-зависимость проекта.
- Для инициализации используется команда:
  ```sh
  npx storybook@latest init --builder webpack5 --legacy-peer-deps
  ```
- В корне проекта должна появиться папка `.storybook/` с конфигурационными файлами.
- Storybook должен поддерживать TypeScript и интеграцию с TailwindCSS (если используется в проекте).

### 3.2. Структура stories
- Для каждого компонента библиотеки должен быть создан файл stories (например, `MyComponent.stories.tsx`).
- В stories должны быть представлены все основные варианты использования компонента (разные пропсы, состояния, темы, edge cases).
- Stories должны быть лаконичными, самодостаточными и не зависеть от внешнего состояния приложения.

### 3.3. Документация и контракты
- Для каждого компонента должна быть документация (MDX или markdown), описывающая:
  - Назначение компонента
  - Пропсы и их типы
  - Примеры использования
  - Контракт (ожидаемое поведение, ограничения, edge cases)
- Документация должна быть доступна в Storybook через вкладку Docs или отдельные stories.
- Контракты компонентов должны быть самодостаточными и не содержать неявных ссылок на другие части системы.

### 3.4. Организация библиотеки компонентов
- Все компоненты должны быть размещены в папке `components/` (или аналогичной).
- Для альтернативных реализаций одного и того же UI-элемента допускается хранение их в отдельных подпапках или файлах с явным указанием варианта (например, `DropdownVariantA.tsx`, `DropdownVariantB.tsx`).
- Экспортировать в основной проект только утверждённые реализации, все варианты доступны в Storybook.

### 3.5. Автоматизация сборки и деплоя
- Storybook должен собираться отдельной командой:
  ```sh
  npm run build-storybook
  ```
- Для деплоя Storybook должен быть настроен CI/CD (например, GitHub Actions) с выкладкой на отдельный домен или ветку (например, GitHub Pages, Vercel, Netlify).
- После каждого коммита в основную ветку Storybook должен автоматически обновляться на сервере.

### 3.6. Взаимодействие с Storybook
- Любой участник команды может запускать Storybook локально командой:
  ```sh
  npm run storybook
  ```
- Для просмотра и тестирования компонентов Storybook должен быть доступен по публичной ссылке.
- Для коридорного тестирования предоставляется ссылка на Storybook, где можно быстро переключать реализации и сценарии.
- Фидбек по компонентам собирается через отдельный канал (issue tracker, Google Form и т.д.).

## 4. Требования к поддержке и развитию
- Все новые UI-компоненты и их варианты должны сопровождаться stories и документацией.
- При изменении контракта компонента stories и документация должны быть обновлены.
- Устаревшие реализации должны быть помечены как deprecated в Storybook.

## 5. Пример структуры файлов

```
components/
  MyChip/
    MyChip.tsx
    MyChip.stories.tsx
    MyChip.md
    MyChipContract.md
  Dropdown/
    DropdownVariantA.tsx
    DropdownVariantA.stories.tsx
    DropdownVariantB.tsx
    DropdownVariantB.stories.tsx
    Dropdown.md
    DropdownContract.md
.storybook/
  main.js
  preview.js
  ...
```

## 6. Пример содержания stories

```tsx
// MyChip.stories.tsx
import { MyChip } from './MyChip';
import type { Meta, StoryObj } from '@storybook/react';

const meta: Meta<typeof MyChip> = {
  title: 'Components/MyChip',
  component: MyChip,
  parameters: {
    docs: {
      description: {
        component: 'Чипс для выбора сложности задания. Поддерживает одиночный и множественный выбор.'
      }
    }
  }
};
export default meta;

type Story = StoryObj<typeof MyChip>;

export const Default: Story = {
  args: {
    label: 'Сложность 1',
    selected: false,
    onClick: () => {},
  },
};

export const Selected: Story = {
  args: {
    label: 'Сложность 2',
    selected: true,
    onClick: () => {},
  },
};
```

## 7. Пример содержания контракта компонента

```md
# Контракт компонента MyChip

## Назначение
Компонент отображает чипс для выбора сложности задания. Может быть использован в режиме одиночного или множественного выбора.

## Пропсы
- `label: string` — текст на чипсе
- `selected: boolean` — выбран ли чипс
- `onClick: () => void` — обработчик клика

## Ожидаемое поведение
- При клике вызывает onClick
- Визуально выделяется, если selected=true
- Должен быть доступен для управления с клавиатуры

## Ограничения
- Не должен содержать бизнес-логику фильтрации
- Не должен зависеть от внешнего состояния
```

## 8. Прочие положения
- Контракт может быть передан другому агенту (человеку или ИИ) без потери контекста.
- Все термины и ссылки должны быть раскрыты и не содержать неявных зависимостей.
- Любые изменения в процессе внедрения должны фиксироваться в истории изменений контракта. 