# Контракт: Управление пользователями

## Метаданные
- **Версия**: 1.0.0
- **Статус**: В разработке
- **Последнее обновление**: 2023-05-23
- **Последний редактор**: AI
- **Ветка разработки**: main

## История изменений
| Дата | Версия | Автор | Описание изменений | PR |
|------|--------|-------|-------------------|-----|
| 2023-05-23 | 1.0.0 | AI | Начальная версия | - |

## Назначение

Данный контракт описывает компонент управления пользователями в системе подготовки к ЕГЭ по русскому языку. Компонент обеспечивает аутентификацию пользователей (учителей) и позволяет переключаться между профилями.

## Общее описание компонента

Компонент управления пользователями предоставляет функциональность для входа в систему и переключения между профилями пользователей с ролью "Учитель". Система предполагает работу исключительно учителей, которые могут создавать и назначать тесты ученикам.

## Роли пользователей

### Учитель
- Создание и редактирование тестов
- Назначение тестов ученикам и группам
- Просмотр результатов и статистики для своих учеников
- Управление своим профилем

## Компоненты системы

### UserManager (Менеджер пользователей)

#### Функциональность
- Аутентификация пользователей
- Управление профилями
- Переключение между профилями
- Управление личными настройками

#### Интерфейсы
- **login**: Вход в систему
- **logout**: Выход из системы
- **getUserProfile**: Получение профиля пользователя
- **updateUserProfile**: Обновление профиля пользователя
- **getUserProfiles**: Получение списка доступных профилей
- **switchProfile**: Переключение между профилями

## Визуальные компоненты

### Переключатель профилей (ProfileSwitcher)

#### Описание
Компонент реализован в виде выпадающего списка (дроп-дауна) в верхней части интерфейса. Позволяет быстро переключаться между разными профилями пользователя.

#### Визуальное представление
```
+----------------------------------+
| Текущий профиль ▼                |
+----------------------------------+
| Профиль 1                        |
| Профиль 2                        |
| Профиль 3                        |
| -------------------------------- |
| + Создать новый профиль          |
+----------------------------------+
```

#### Состояния
- **Свернутое**: Отображается только текущий выбранный профиль
- **Развернутое**: Отображается список всех доступных профилей и опция создания нового
- **Состояние загрузки**: Отображается индикатор загрузки при переключении профилей
- **Состояние ошибки**: Отображается сообщение об ошибке, если переключение не удалось

#### Поведение
- При клике на компонент раскрывается список доступных профилей
- При выборе профиля из списка происходит переключение на этот профиль
- При выборе "Создать новый профиль" открывается модальное окно создания профиля
- Текущий активный профиль выделяется визуально в списке

#### Доступность
- Компонент доступен с клавиатуры (Tab, Enter, стрелки)
- Компонент имеет ARIA-атрибуты для совместимости со скринридерами
- Контрастность цветов соответствует требованиям WCAG 2.0 AA

## Схема данных

### User (Пользователь)
```typescript
interface User {
  id: string;            // Уникальный идентификатор
  email: string;         // Email (логин)
  passwordHash: string;  // Хеш пароля
  firstName: string;     // Имя
  lastName: string;      // Фамилия
  middleName?: string;   // Отчество (опционально)
  avatarUrl?: string;    // URL аватара
  createdAt: Date;       // Дата и время создания
  updatedAt: Date;       // Дата и время последнего обновления
  lastLoginAt?: Date;    // Дата и время последнего входа
  profiles: Profile[];   // Профили пользователя
}
```

### Profile (Профиль)
```typescript
interface Profile {
  id: string;               // Уникальный идентификатор
  userId: string;           // ID пользователя
  name: string;             // Название профиля
  institution?: string;     // Учебное заведение
  position?: string;        // Должность
  groups?: string[];        // Группы/классы
  subjects?: string[];      // Предметы
  isDefault: boolean;       // Является ли профиль профилем по умолчанию
  createdAt: Date;          // Дата и время создания
  updatedAt: Date;          // Дата и время последнего обновления
  settings: ProfileSettings; // Настройки профиля
}

interface ProfileSettings {
  theme: string;               // Тема оформления
  language: string;            // Предпочитаемый язык
  notificationsEnabled: boolean; // Включены ли уведомления
  defaultTestSettings?: {      // Настройки тестов по умолчанию
    timeLimit?: number;        // Ограничение по времени
    questionsPerTest?: number; // Количество вопросов в тесте
    difficulty?: string;       // Сложность по умолчанию
  };
}
```

## Алгоритмы и процессы

### Процесс входа пользователя
1. Пользователь вводит email и пароль
2. Система проверяет корректность учетных данных
3. При успешной аутентификации система создает сессию и предоставляет токен доступа
4. Система загружает профиль по умолчанию или последний использованный профиль
5. Пользователь перенаправляется на главную страницу приложения

### Процесс переключения профиля
1. Пользователь нажимает на переключатель профилей
2. Система отображает список доступных профилей
3. Пользователь выбирает нужный профиль
4. Система загружает выбранный профиль и обновляет пользовательский интерфейс
5. Система сохраняет выбор профиля для последующих сессий

### Процесс создания нового профиля
1. Пользователь выбирает опцию "Создать новый профиль"
2. Система отображает форму создания профиля
3. Пользователь заполняет необходимые данные
4. Система валидирует введенные данные
5. Система создает новый профиль и обновляет список профилей
6. Пользователь может сразу переключиться на новый профиль

## Взаимодействие с другими компонентами

### Компонент создания тестов
- Получает информацию о текущем профиле для сохранения авторства теста
- Использует настройки профиля для предзаполнения параметров теста

### Компонент назначения тестов
- Получает информацию о текущем профиле для назначения тестов
- Использует группы из профиля для быстрого выбора целевой аудитории

## Нефункциональные требования

### Производительность
- Время входа в систему: не более 2 секунд
- Время переключения между профилями: не более 1 секунды
- Время создания нового профиля: не более 2 секунд

### Безопасность
- Хранение паролей в хешированном виде с использованием соли
- Защита от распространенных атак (SQL-инъекции, XSS, CSRF)
- Шифрование чувствительных данных
- Автоматический выход из системы после 30 минут неактивности

## Примеры использования

### Пример 1: Аутентификация пользователя
```typescript
// Данные для входа
const credentials = {
  email: "teacher@school.edu",
  password: "securePassword123"
};

// Аутентификация пользователя
const { user, token } = await userManager.login(credentials);

// Сохранение токена
localStorage.setItem('auth_token', token);

// Получение профилей пользователя
const profiles = await userManager.getUserProfiles(user.id);

// Загрузка профиля по умолчанию
const defaultProfile = profiles.find(p => p.isDefault) || profiles[0];
await userManager.switchProfile(defaultProfile.id);
```

### Пример 2: Переключение между профилями
```typescript
// Получение списка доступных профилей
const profiles = await userManager.getUserProfiles(currentUser.id);

// Отображение списка профилей в компоненте
function renderProfileSwitcher(profiles, currentProfileId) {
  return (
    <div className="profile-switcher">
      <div className="current-profile">
        {profiles.find(p => p.id === currentProfileId).name} ▼
      </div>
      <div className="profile-list">
        {profiles.map(profile => (
          <div 
            key={profile.id} 
            className={`profile-item ${profile.id === currentProfileId ? 'active' : ''}`}
            onClick={() => switchProfile(profile.id)}
          >
            {profile.name}
          </div>
        ))}
        <div className="new-profile" onClick={createNewProfile}>
          + Создать новый профиль
        </div>
      </div>
    </div>
  );
}

// Функция переключения профиля
async function switchProfile(profileId) {
  try {
    await userManager.switchProfile(profileId);
    // Обновление UI
    updateInterfaceForProfile(profileId);
  } catch (error) {
    showError('Не удалось переключить профиль');
  }
}
```

## Связанные контракты
- [Test Creation Contract](./Test-Creation-Contract.md)
- [Test Assignment Contract](./Test-Assignment-Contract.md) 