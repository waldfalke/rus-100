# Мезо-контракт: Внедрение Storybook и среды атомарного тестирования UI-компонентов

## Цель
Внедрить Storybook и сопутствующую инфраструктуру для изолированной разработки, тестирования, документирования и сравнения вариантов UI-компонентов.

## Область действия
- Установка и настройка Storybook для Next.js + TypeScript
- Организация структуры stories и документации
- Автоматизация сборки и деплоя Storybook
- Регламентация процесса добавления новых вариантов компонентов
- Обеспечение прозрачности и повторяемости атомарного тестирования

## Критерии успеха
- Storybook установлен и интегрирован с проектом
- Для каждого компонента есть хотя бы одна story
- Для новых вариантов компонентов создаются отдельные stories и микро-контракты
- Storybook доступен для команды локально и по публичной ссылке
- Документация и контракты компонентов доступны через Storybook

## Особенности и риски: dependency hell и расхождение версий
- В проекте используются библиотеки с несовместимыми версиями (например, date-fns@4.1.0 и react-day-picker@8.10.1, который требует date-fns@^2.28.0 || ^3.0.0)
- Storybook и его аддоны могут тянуть свои версии зависимостей, что приводит к конфликтам (npm ERESOLVE)
- npm v7+ строго проверяет peer dependencies и блокирует установку при несовместимости
- Возможные обходы (npm install --legacy-peer-deps, --force) не гарантируют стабильную работу и могут привести к неработающим частям приложения
- Рекомендуется рассмотреть изоляцию Storybook (отдельный package/репозиторий) или формализованный процесс обновления зависимостей
- Любые изменения в инфраструктуре должны тестироваться изолированно и документироваться

## Связанные микро-контракты
- Контракт на добавление stories для компонента
- Контракт на написание документации для компонента
- Контракт на автоматизацию деплоя Storybook
- Контракт на ревью и утверждение новых вариантов

## Примечание
Данный контракт может быть делегирован другому агенту без потери контекста. Все термины раскрыты, неявных связей нет. 