# План внедрения типографической системы RUS100

**ВАЖНОЕ ОБЩЕЕ ОГРАНИЧЕНИЕ ДЛЯ ИИ АССИСТЕНТА:** При выполнении любых задач на основе данного плана, ИИ ассистент должен **строго ограничиваться изменениями, связанными исключительно с типографикой**. Это включает в себя: семейство шрифтов, размеры, начертания (вес), межстрочные интервалы и их непосредственное применение в CSS-классах, стилях компонентов или конфигурационных файлах (токены, Tailwind CSS, настройки Next.js). **ИИ не должен изменять:**
-   Общий дизайн и макет компонентов или страниц.
-   Цветовую схему (кроме случаев, когда это напрямую связано с обеспечением читаемости нового шрифта и явно согласовано).
-   Отступы, поля, размеры блоков, не связанные напрямую с текстовым содержимым или его `line-height`.
-   Логику работы компонентов.
-   Структуру JSX/HTML, за исключением добавления/изменения CSS-классов или стилей, необходимых для применения типографики.
Любые предложения по изменениям, выходящим за рамки этих ограничений, должны быть явно обозначены и утверждены пользователем перед реализацией.

## 1. Подготовительный этап

### 1.1. Анализ и резервное копирование
- [ ] Создать резервную копию ключевых файлов:
  - `app/layout.tsx`
  - `tailwind.config.ts`
  - `design-system/tokens/base/typography.json`
- [ ] Проанализировать текущее состояние типографики в проекте:
  - Размеры шрифтов на разных экранах (основной шрифт сейчас Inter).
  - Использование шрифтов в Badge и CounterBadge (текущий шрифт - Inter).
  - Производительность загрузки шрифтов (текущего основного шрифта Inter).

### 1.2. Тестовая сборка проекта
- [ ] Проверить текущую совместимость с GitHub Pages
- [ ] Убедиться, что webpack сборка работает с текущими настройками
- [ ] Проверить текущее поведение CounterBadge в разных браузерах

## 2. Интеграция шрифтов и обновление токенов
**Ограничение для ИИ:** Задачи в этом разделе включают настройку шрифта `Source Serif Pro` для использования в качестве **второстепенного шрифта (для заголовков и акцентов)**, и связанных с ним токенов. `Inter` остается основным шрифтом. Модификации должны затрагивать только файлы и конфигурации, необходимые для интеграции `Source Serif Pro` и обеспечения его доступности, не изменяя другие аспекты системы и сохраняя `Inter` как основной шрифт.

### 2.1. Конфигурирование шрифта Source Serif Pro для заголовков и акцентов
- [ ] Обновить `app/layout.tsx`, добавив шрифт `Source Serif Pro` и обеспечив доступность обоих шрифтов (`Inter` и `Source Serif Pro`) в приложении:
  - **Ограничение для ИИ:** ИИ должен **добавить** конфигурацию для `Source Serif Pro`. Существующая конфигурация шрифта `Inter` **должна оставаться неизменной и активной**. `className` в теге `<html>` должен быть обновлен, чтобы включать **обе** CSS-переменные для шрифтов (`inter.variable` и `sourceSerifPro.variable`). Другая логика файла не должна изменяться.
```typescript
import { Inter, Source_Serif_Pro } from "next/font/google" // Убедиться в корректном импорте Source_Serif_Pro

const inter = Inter({ // Существующая конфигурация Inter - НЕ ИЗМЕНЯТЬ
  subsets: ["latin", "cyrillic"],
  display: "swap",
  variable: "--font-inter",
  weight: ["400", "500", "600", "700"]
})

const sourceSerifPro = Source_Serif_Pro({ // Новая конфигурация для Source Serif Pro (для заголовков)
  subsets: ["latin", "cyrillic"],
  display: "swap",
  variable: "--font-source-serif-pro", // CSS-переменная для Source Serif Pro
  weight: ["400", "500", "600", "700"] // Указать актуальные веса для Source Serif Pro
})

// Обновить className в HTML теге для включения ОБЕИХ переменных шрифтов
<html lang="ru" suppressHydrationWarning className={`${inter.variable} ${sourceSerifPro.variable}`}> 
```

### 2.2. Обновление токенов типографики
- [ ] Обновить `design-system/tokens/base/typography.json`:
  - **Ограничение для ИИ:** ИИ должен добавить определения `fontFamily` для `source-serif-pro` и обновить токен `serif` для использования `Source Serif Pro` (если он становится основным серифным шрифтом для заголовков). Токен `inter` и `sans` (использующий Inter) должен оставаться. **Обновить секцию `fontSize` для отражения новой семантической и адаптивной шкалы (`app-h1-mobile`, `app-h1`, `app-h2-mobile`, `app-h2`, `app-h3-mobile`, `app-h3`, `app-body`, `app-small`, `app-caption`). Старые токены размеров (xs, sm, base, lg и т.д.) должны быть удалены из `fontSize`.** При необходимости, скорректировать токены `lineHeight` согласно актуальной шкале. Структура файла и другие типы токенов не должны изменяться.
- [ ] Добавить новые значения интерлиньяжа для кириллического текста (если это не сделано ранее и требуется).
- [ ] Добавить токен для шрифта `Source Serif Pro` в секции `fontFamily`.
- [ ] Запустить сборку токенов:
```bash
npm run build:tokens
```
- [ ] Проверить сгенерированные файлы:
  - `styles/tokens.light.css`
  - `styles/tokens.dark.css`
  - `src/tokens/`

### 2.3. Обновление Tailwind конфигурации
- [ ] Обновить `tailwind.config.ts`:
  - **Ограничение для ИИ:** ИИ должен добавить классы для `font-source-serif-pro` и `serif` (использующего `Source Serif Pro`) в секции `fontFamily`. Класс `font-inter` и `font-sans` (использующий `Inter`) должен оставаться. Убедиться, что класс `text-base` в `fontSize` соответствует `1rem` (16px) и, при необходимости скорректировать другие значения `fontSize` и `lineHeight` согласно актуальной шкале. Остальная конфигурация Tailwind не должна изменяться.
- [ ] Обновить с новыми размерами шрифтов (если они изменились).
- [ ] Добавить классы для шрифтовой пары (font-inter, font-source-serif-pro).
- [ ] Добавить линии интерлиньяжа для кириллицы (если это не сделано ранее и требуется).
- [ ] Запустить сборку проекта для проверки:
```bash
npm run build
```

## 3. Разработка компонентов типографики
**Ограничение для ИИ:** При разработке или модификации компонентов ИИ должен фокусироваться *исключительно* на применении новых шрифтовых стилей (`Source Serif Pro` для заголовков и акцентных элементов, `Inter` для основного текста и UI-элементов, а также соответствующие размеры, веса, межстрочные интервалы) через классы Tailwind CSS и дизайн-токены. **Не изменять логику, структуру JSX (кроме классов для шрифтов), цвета, отступы или другие аспекты дизайна компонентов, не связанные напрямую с применением шрифтов.**

### 3.1. Создание базовых компонентов
- [ ] Создать файл `components/ui/typography.tsx` (если не существует).
- [ ] Разработать/обновить компонент `Typography` со всеми вариантами: заголовки (`h1`, `h2`, `h3` - используя семантические адаптивные классы) должны использовать `Source Serif Pro`; основной текст (`p`, `small`, `caption`, `lead` и т.д.) должен использовать `Inter`. Варианты `h4-h6` должны быть удалены или помечены как устаревшие в компоненте.
- [ ] Добавить компонентам аннотацию `@typography-status` (если это часть процесса).
- [ ] Тестировать в Storybook.

### 3.2. Создание специализированных компонентов
- [ ] Создать/обновить `components/ui/GrammarRuleBlock.tsx` (если требуется).
- [ ] Добавить соответствующие стили для правил русского языка: заголовок блока должен использовать `Source Serif Pro`, основной текст правила – `Inter`.
- [ ] Протестировать адаптивность и корректное отображение кириллицы.

### 3.3. Обновление Badge и CounterBadge
- [ ] Проверить и при необходимости обновить файл `components/ui/badge.tsx` в части стилей шрифта (`fontSize`, `fontWeight`), если это требуется новыми токенами. **Основной шрифт для текста в бейджах – `Inter`**. 
- [ ] Проверить корректность отображения текста (шрифт `Inter`, нормальное начертание) и чисел (шрифт `Inter`, полужирное начертание) в `CounterBadge`. **Не менять используемый шрифт `Inter` на `Source Serif Pro` для этих компонентов.**
- [ ] Протестировать с разными вариантами стилей и размеров.

## 4. Обновление существующих компонентов
**Ограничение для ИИ:** Аналогично разделу 3. При обновлении существующих компонентов ИИ должен изменять *только* CSS-классы, отвечающие за шрифтовые характеристики текста. Применять `Source Serif Pro` **только к элементам, которые являются заголовками или акцентным текстом**. Для всего остального текста (основной текст, метки, элементы интерфейса) должен сохраниться шрифт `Inter`. **Не изменять компоновку, цвета, состояние, логику, иконки или другие нешрифтовые стили.**

### 4.1. Обновление SelectionDropdown и других ключевых компонентов
- [ ] Обновить основные интерфейсные компоненты с новой типографикой (применяя `Source Serif Pro` к заголовкам и `Inter` к основному тексту/элементам интерфейса).
- [ ] Проверить адаптивность компонентов (в части читаемости текста).
- [ ] Тестировать взаимодействие компонентов между собой.

### 4.2. Проверка специальных случаев
- [ ] Проверить обработку числовых значений в бейджах (шрифт `Inter`, полужирное начертание).
- [ ] Проверить отображение кириллических символов во всех компонентах.
- [ ] Убедиться в корректном отображении при переключении темы (если это влияет на цвета текста, а не на сами шрифты).

## 5. Тестирование и документация

### 5.1. Комплексное тестирование
- [ ] Проверить загрузку шрифтов (`Inter`, `Source Serif Pro`) во всех браузерах.
- [ ] Проверить отображение текста на мобильных устройствах.
- [ ] Провести тест производительности загрузки шрифтов.
- [ ] Проверить совместимость с GitHub Pages.

### 5.2. Финальная документация
- [ ] Обновить документацию по типографике (`typography-guidelines-rus100.md`, `typography-contract-rus100.md`) для отражения новой 3-уровневой адаптивной системы заголовков (H1-H3 с `Source Serif Pro`), использования `Inter` для основного текста (`p`, `small`, `caption` и др.), и применения семантических классов.
- [ ] Создать/обновить примеры использования в Storybook, демонстрирующие новую шкалу типографики (H1-H3, p, small, caption, lead и др.) с их адаптивными размерами и корректными шрифтами.
- [ ] Обновить информацию в README о типографической системе (новая шрифтовая пара: `Inter` для основного текста, `Source Serif Pro` для заголовков).

## 6. Внедрение и обратная связь

### 6.1. Поэтапное внедрение
- [ ] Внедрить новую типографику (`Inter` + `Source Serif Pro`) сначала на тестовой странице.
- [ ] Получить обратную связь от дизайнеров и разработчиков.
- [ ] Скорректировать значения (размеры, веса, интерлиньяжи), если необходимо, с соблюдением ограничений для ИИ.

### 6.2. Полная интеграция
- [ ] Внедрить по всему проекту.
- [ ] Провести финальное тестирование.
- [ ] Создать задачи для исправления возможных проблем (связанных с типографикой).

## Особые замечания

1. При обновлении типографики особое внимание уделять:
   - Корректному отображению кириллических символов.
   - Правильному форматированию числовых значений в `CounterBadge` (текст `Inter normal`, число `Inter semibold`).
   - Производительности при загрузке дополнительного шрифта `Source Serif Pro`.

2. Использовать TokenDebugger для проверки токенов:
```tsx
import { TokenDebugger } from '@/components/debug/TokenDebugger';

<TokenDebugger />
```

3. При любых изменениях в токенах (`design-system/tokens/base/typography.json`) запускать:
```bash
npm run build:tokens
```

4. Учитывать особенности webpack конфигурации проекта и необходимость поддержки GitHub Pages. 