# Техническая архитектура системы подготовки к ЕГЭ

## Общая архитектура

Система подготовки к ЕГЭ будет реализована как веб-приложение с использованием современной многоуровневой архитектуры. Система включает в себя следующие основные уровни:

1. **Уровень представления** - интерфейс пользователя
2. **Уровень бизнес-логики** - компоненты, реализующие основную функциональность системы
3. **Уровень доступа к данным** - компоненты для работы с базой данных
4. **Уровень данных** - база данных и файловое хранилище

## Технологический стек

### Серверная часть
- **Язык программирования**: Java 17
- **Фреймворк**: Spring Boot 3.1
- **Управление зависимостями**: Maven
- **База данных**: PostgreSQL 15
- **ORM**: Hibernate 6.2 / Spring Data JPA
- **Безопасность**: Spring Security
- **Аутентификация**: JWT (JSON Web Tokens)
- **Документация API**: Swagger / OpenAPI 3.0
- **Тестирование**: JUnit 5, Mockito, Testcontainers
- **Логирование**: SLF4J + Logback

### Клиентская часть
- **Фреймворк**: React 18
- **Управление состоянием**: Redux Toolkit
- **Типизация**: TypeScript
- **UI-компоненты**: Material-UI
- **Маршрутизация**: React Router
- **Формы**: Formik + Yup
- **HTTP-клиент**: Axios
- **Тестирование**: Jest, React Testing Library
- **Сборка**: Webpack

### Инфраструктура
- **Контейнеризация**: Docker
- **Оркестрация**: Docker Compose (разработка), Kubernetes (продакшн)
- **CI/CD**: GitHub Actions
- **Мониторинг**: Prometheus + Grafana
- **Логирование**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **Кэширование**: Redis
- **Обмен сообщениями**: RabbitMQ (при необходимости)

## Архитектурные компоненты

### Серверная часть

#### Модули API (Controllers)
- **UsersController** - управление пользователями
- **AuthController** - аутентификация и авторизация
- **SubjectsController** - управление предметами
- **TopicsController** - управление темами
- **QuestionsController** - управление вопросами
- **TestsController** - управление тестами
- **TestAssignmentsController** - назначение тестов
- **TestResultsController** - результаты тестов
- **MaterialsController** - учебные материалы

#### Сервисы (Services)
- **UserService** - бизнес-логика управления пользователями
- **AuthService** - бизнес-логика аутентификации
- **SubjectService** - бизнес-логика управления предметами
- **TopicService** - бизнес-логика управления темами
- **QuestionService** - бизнес-логика управления вопросами
- **TestService** - бизнес-логика управления тестами
- **TestAssignmentService** - бизнес-логика назначения тестов
- **TestResultService** - бизнес-логика управления результатами
- **MaterialService** - бизнес-логика управления учебными материалами
- **NotificationService** - отправка уведомлений
- **AnalyticsService** - аналитика и отчеты

#### Репозитории (Repositories)
- **UserRepository** - доступ к данным пользователей
- **RoleRepository** - доступ к данным ролей
- **GroupRepository** - доступ к данным групп
- **SubjectRepository** - доступ к данным предметов
- **TopicRepository** - доступ к данным тем
- **QuestionRepository** - доступ к данным вопросов
- **TestRepository** - доступ к данным тестов
- **TestQuestionRepository** - доступ к данным вопросов в тестах
- **TestAssignmentRepository** - доступ к данным о назначенных тестах
- **UserAnswerRepository** - доступ к данным ответов пользователей
- **TestResultRepository** - доступ к данным результатов тестов
- **MaterialRepository** - доступ к данным учебных материалов

#### Модели (Models)
- **User** - пользователь системы
- **Role** - роль пользователя
- **Group** - группа учеников
- **Subject** - предмет ЕГЭ
- **Topic** - тема в рамках предмета
- **QuestionType** - тип вопроса
- **Question** - вопрос
- **Test** - тест
- **TestQuestion** - вопрос в тесте
- **TestAssignment** - назначение теста
- **UserAnswer** - ответ пользователя на вопрос
- **TestResult** - результат теста
- **Material** - учебный материал

#### DTO (Data Transfer Objects)
- **UserDTO** - DTO для передачи данных о пользователе
- **AuthRequestDTO** - DTO для запроса аутентификации
- **AuthResponseDTO** - DTO для ответа на запрос аутентификации
- **SubjectDTO** - DTO для передачи данных о предмете
- **TopicDTO** - DTO для передачи данных о теме
- **QuestionDTO** - DTO для передачи данных о вопросе
- **TestDTO** - DTO для передачи данных о тесте
- **TestAssignmentDTO** - DTO для передачи данных о назначении теста
- **TestResultDTO** - DTO для передачи данных о результате теста
- **MaterialDTO** - DTO для передачи данных об учебном материале

### Клиентская часть

#### Модули
- **Аутентификация** - регистрация, вход, восстановление пароля
- **Панель управления учителя** - создание и назначение тестов
- **Панель управления ученика** - прохождение тестов
- **Управление пользователями** - профиль, настройки
- **Управление группами** - создание и редактирование групп
- **Управление тестами** - создание, редактирование, просмотр тестов
- **Прохождение тестов** - интерфейс для прохождения тестов
- **Аналитика и отчеты** - просмотр результатов и статистики
- **Учебные материалы** - доступ к учебным материалам

#### Компоненты React
- **AuthComponents** - компоненты аутентификации
- **DashboardComponents** - компоненты панели управления
- **UserComponents** - компоненты управления пользователями
- **GroupComponents** - компоненты управления группами
- **SubjectComponents** - компоненты управления предметами
- **TopicComponents** - компоненты управления темами
- **QuestionComponents** - компоненты управления вопросами
- **TestComponents** - компоненты управления тестами
- **TestRunnerComponents** - компоненты для прохождения тестов
- **ResultComponents** - компоненты для просмотра результатов
- **AnalyticsComponents** - компоненты для аналитики
- **MaterialComponents** - компоненты для работы с учебными материалами

## Диаграмма компонентов

```
+-------------------+      +--------------------+     +-------------------+
|                   |      |                    |     |                   |
|  Уровень          |      |   Уровень          |     |   Уровень         |
|  представления    +----->+   бизнес-логики    +---->+   доступа к данным|
|  (React)          |      |   (Spring Boot)    |     |   (Spring Data)   |
|                   |      |                    |     |                   |
+-------------------+      +--------------------+     +---------+---------+
                                                               |
                                                               v
                                                      +-------------------+
                                                      |                   |
                                                      |   Уровень данных  |
                                                      |   (PostgreSQL)    |
                                                      |                   |
                                                      +-------------------+
```

## API-интерфейсы

### REST API

Система предоставляет REST API для взаимодействия клиентской части с серверной. Основные эндпоинты:

#### Аутентификация
- `POST /api/auth/register` - регистрация нового пользователя
- `POST /api/auth/login` - аутентификация пользователя
- `POST /api/auth/refresh` - обновление токена
- `POST /api/auth/logout` - выход из системы

#### Пользователи
- `GET /api/users` - получение списка пользователей
- `GET /api/users/{id}` - получение пользователя по ID
- `POST /api/users` - создание пользователя
- `PUT /api/users/{id}` - обновление пользователя
- `DELETE /api/users/{id}` - удаление пользователя

#### Группы
- `GET /api/groups` - получение списка групп
- `GET /api/groups/{id}` - получение группы по ID
- `POST /api/groups` - создание группы
- `PUT /api/groups/{id}` - обновление группы
- `DELETE /api/groups/{id}` - удаление группы
- `POST /api/groups/{id}/users` - добавление пользователей в группу
- `DELETE /api/groups/{id}/users/{userId}` - удаление пользователя из группы

#### Предметы и темы
- `GET /api/subjects` - получение списка предметов
- `GET /api/subjects/{id}` - получение предмета по ID
- `GET /api/subjects/{id}/topics` - получение тем предмета
- `GET /api/topics/{id}` - получение темы по ID
- `GET /api/topics/{id}/subtopics` - получение подтем темы

#### Вопросы
- `GET /api/questions` - получение списка вопросов (с фильтрацией)
- `GET /api/questions/{id}` - получение вопроса по ID
- `POST /api/questions` - создание вопроса
- `PUT /api/questions/{id}` - обновление вопроса
- `DELETE /api/questions/{id}` - удаление вопроса

#### Тесты
- `GET /api/tests` - получение списка тестов
- `GET /api/tests/{id}` - получение теста по ID
- `POST /api/tests` - создание теста
- `PUT /api/tests/{id}` - обновление теста
- `DELETE /api/tests/{id}` - удаление теста
- `GET /api/tests/{id}/questions` - получение вопросов теста
- `POST /api/tests/{id}/questions` - добавление вопросов в тест
- `DELETE /api/tests/{id}/questions/{questionId}` - удаление вопроса из теста
- `POST /api/tests/{id}/generate` - генерация теста по критериям
- `POST /api/tests/{id}/publish` - публикация теста

#### Назначение тестов
- `GET /api/test-assignments` - получение списка назначений тестов
- `GET /api/test-assignments/{id}` - получение назначения теста по ID
- `POST /api/test-assignments` - назначение теста
- `PUT /api/test-assignments/{id}` - обновление назначения теста
- `DELETE /api/test-assignments/{id}` - удаление назначения теста

#### Прохождение тестов
- `GET /api/test-assignments/{id}/start` - начало прохождения теста
- `POST /api/test-assignments/{id}/answers` - сохранение ответов
- `POST /api/test-assignments/{id}/submit` - завершение теста

#### Результаты тестов
- `GET /api/test-results` - получение списка результатов тестов
- `GET /api/test-results/{id}` - получение результата теста по ID
- `GET /api/users/{id}/test-results` - получение результатов тестов пользователя

#### Учебные материалы
- `GET /api/materials` - получение списка учебных материалов
- `GET /api/materials/{id}` - получение учебного материала по ID
- `POST /api/materials` - создание учебного материала
- `PUT /api/materials/{id}` - обновление учебного материала
- `DELETE /api/materials/{id}` - удаление учебного материала

## Аутентификация и авторизация

### Процесс аутентификации
1. Пользователь вводит имя пользователя и пароль
2. Сервер проверяет учетные данные
3. При успешной проверке сервер генерирует JWT-токен, содержащий информацию о пользователе и его правах
4. Токен отправляется клиенту
5. Клиент сохраняет токен и использует его для последующих запросов

### Управление правами доступа
- **Роль "Администратор"** - полный доступ ко всем функциям системы
- **Роль "Учитель"** - создание и назначение тестов, просмотр результатов, управление группами
- **Роль "Ученик"** - прохождение назначенных тестов, просмотр своих результатов, доступ к учебным материалам

## Хранение данных

### База данных
- **СУБД**: PostgreSQL
- **Схема базы данных**: см. [Контракт схемы базы данных](../contracts/Database-Schema-Contract.md)

### Хранение файлов
- **Тип хранилища**: Файловая система / Object Storage (например, MinIO для локальной разработки, S3 для продакшн)
- **Типы файлов**: Изображения для вопросов, PDF-документы учебных материалов
- **Управление доступом**: Проверка прав доступа через API, подписанные URL для временного доступа

## Масштабируемость

### Горизонтальное масштабирование
- **API-серверы**: Возможность запуска нескольких экземпляров с балансировкой нагрузки
- **Микросервисы**: При необходимости система может быть разделена на микросервисы
- **Кэширование**: Использование Redis для кэширования частых запросов

### Вертикальное масштабирование
- **База данных**: Оптимизация запросов, индексы, секционирование таблиц
- **Серверы приложений**: Оптимизация использования ресурсов, настройка JVM

## Мониторинг и логирование

### Мониторинг
- **Prometheus**: Сбор метрик производительности
- **Grafana**: Визуализация метрик и создание дашбордов
- **Healthchecks**: Регулярные проверки работоспособности компонентов

### Логирование
- **SLF4J + Logback**: Фреймворк для логирования
- **ELK Stack**: Централизованное хранение и анализ логов
- **Log Levels**: ERROR, WARN, INFO, DEBUG, TRACE
- **Контекст логирования**: Включение информации о пользователе, запросе и т.д.

## Безопасность

### Защита данных
- **HTTPS**: Шифрование данных в пути
- **JWT**: Безопасная аутентификация
- **Хеширование паролей**: Использование современных алгоритмов (BCrypt)
- **Проверка входных данных**: Валидация всех входных данных

### Защита от атак
- **CSRF-защита**: Токены для защиты от межсайтовой подделки запросов
- **XSS-защита**: Экранирование выводимых данных
- **SQL-инъекции**: Использование параметризованных запросов
- **Rate Limiting**: Ограничение количества запросов от одного IP

## Развертывание

### Окружения
- **Разработка**: Локальная среда для разработчиков
- **Тестирование**: Среда для функционального и интеграционного тестирования
- **Staging**: Предпродакшн-среда для финального тестирования
- **Продакшн**: Производственная среда

### CI/CD
- **GitHub Actions**: Автоматизация сборки, тестирования и развертывания
- **Docker**: Создание контейнеров с приложением
- **Docker Compose**: Локальное развертывание для разработки
- **Kubernetes**: Управление контейнерами в продакшн-среде

## Тестирование

### Уровни тестирования
- **Модульное тестирование**: JUnit, React Testing Library
- **Интеграционное тестирование**: Testcontainers, REST Assured
- **UI-тестирование**: Cypress
- **Нагрузочное тестирование**: JMeter
- **Безопасность**: OWASP ZAP

### Стратегия тестирования
- **TDD/BDD**: Разработка через тестирование, когда это применимо
- **Автоматизация**: Максимальное покрытие автоматическими тестами
- **CI**: Запуск тестов при каждом коммите
- **Ручное тестирование**: Для сложных пользовательских сценариев

## Документация

### Документация по API
- **Swagger/OpenAPI**: Автоматическая генерация документации API
- **Postman Collections**: Коллекции запросов для тестирования API

### Техническая документация
- **JavaDoc**: Документирование кода Java
- **README-файлы**: Основная информация о компонентах
- **Wiki**: Детальная документация по архитектуре и процессам
- **Диаграммы**: UML, ER-диаграммы, диаграммы последовательности

## Интеграции

### Возможные интеграции
- **LMS-системы**: Интеграция с системами управления обучением
- **Официальные ресурсы ЕГЭ**: Импорт заданий и материалов
- **Системы аналитики**: Экспорт данных для внешней аналитики
- **Email/SMS**: Отправка уведомлений 