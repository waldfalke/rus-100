#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
echo "üîç Checking for component and token changes..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
if git diff --cached --name-only | grep -E "src/components/|src/app/"; then
  echo "üì¶ Components changed, updating tests..."
  npm run update:tests
  git add tests/e2e/steps.ts tests/e2e/*.feature
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–æ–∫–µ–Ω–∞—Ö
if git diff --cached --name-only | grep "design-system/tokens/"; then
  echo "üé® Design tokens changed, syncing tests..."
  npm run sync:tokens
  git add tests/e2e/design-tokens.spec.ts
fi

# –†–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º BDD —Ç–µ—Å—Ç—ã
echo "ü•í Regenerating BDD tests..."
npx bddgen

echo "‚úÖ Pre-commit checks complete!"
