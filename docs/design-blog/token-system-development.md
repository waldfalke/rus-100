# Дизайнерский рабочий блог: Разработка системы дизайн-токенов

*Этот документ представляет собой рабочие заметки дизайнера в процессе аудита существующей системы стилей и разработки новой системы дизайн-токенов.*

---

## 27.05.2023 — Аудит текущей системы стилей

### Проблема двойных переменных

Обнаружил серьезную проблему: дублирование CSS-переменных в двух разных файлах (`app/globals.css` и `styles/globals.css`) с разными значениями. Это создает непредсказуемое поведение при стилизации — какая переменная "победит" зависит от порядка импорта.

Пример:
```css
/* В app/globals.css */
--primary: 173 100% 28%;

/* В styles/globals.css */
--primary: 0 0% 9%;
```

**Идея решения**: Создать единый источник истины для всех переменных. Style Dictionary идеально подходит для этой цели — он сгенерирует CSS-переменные из JSON-файлов токенов и гарантирует отсутствие дублирования.

### Несогласованные темы

Заметил, что переключение тем может вызвать визуальные артефакты из-за несогласованности значений между файлами. Кроме того, некоторые компоненты, похоже, "жестко" стилизованы без учета тем.

**Идея решения**: Определить единую структуру тем с четкой иерархией токенов:
- Базовые (primitive) — абсолютные значения
- Семантические — смысловые значения, ссылающиеся на базовые
- Компонентные — специфичные для компонентов

## 28.05.2023 — Проблемы с сеткой и ритмом

### Отсутствие модульной сетки

Проанализировав компоненты, не обнаружил единой системы сеток. Каждый компонент использует собственный подход:
- Где-то `grid-cols-2`
- Где-то `flex justify-between`
- Где-то жестко заданные значения в пикселях

Это создает визуальную нестабильность и затрудняет поддержку.

**Идея решения**: Создать стандартную модульную сетку с предопределенными колонками и желобами (gutters), которые будут основаны на токенах. Примерный подход:

```
Базовая единица сетки: 8px (0.5rem)
Количество колонок: 12
Желоба: 16px (1rem) для десктопа, 8px (0.5rem) для мобильных
Контейнеры:
  - xs: 100% (max 640px)
  - sm: 640px
  - md: 768px
  - lg: 1024px
  - xl: 1280px
  - 2xl: 1400px
```

### Вертикальный ритм страниц непоследователен

Заметил, что отступы между компонентами на страницах непоследовательны. На странице аккаунта используется `space-y-6`, но в других местах видел `mb-4`, `mt-8` и даже жестко прописанные маргины.

**Идея решения**: Создать систему вертикального ритма, основанную на базовой единице (8px). Определить стандартные отступы между секциями, компонентами и внутри компонентов:

```
Отступы между секциями: 48px (3rem)
Отступы между компонентами: 24px (1.5rem)
Отступы внутри компонентов: 16px (1rem)
```

## 29.05.2023 — Типографика и цвета

### Несогласованная типографика

Заметил непоследовательное использование размеров шрифта, межстрочных интервалов и начертаний.

**Идея решения**: Создать типографическую шкалу, основанную на модульном масштабе (1.25):

```
Базовый размер: 1rem (16px)
Шкала:
  - xs: 0.75rem (12px)
  - sm: 0.875rem (14px)
  - base: 1rem (16px)
  - lg: 1.125rem (18px)
  - xl: 1.25rem (20px)
  - 2xl: 1.5rem (24px)
  - 3xl: 1.875rem (30px)
  - 4xl: 2.25rem (36px)
```

Также определить стандартные комбинации размер/межстрочный интервал/начертание для заголовков и текстовых блоков.

### Цветовая палитра не структурирована

Цвета определены как CSS-переменные, но без логической структуры или системы оттенков.

**Идея решения**: Создать систему цветов по модели Tailwind с 10 оттенками для каждого основного цвета:

```
primary-50, primary-100, ..., primary-900
neutral-50, neutral-100, ..., neutral-900
```

Затем определить семантические цвета, которые ссылаются на эти базовые оттенки:

```
background: neutral-50
text-primary: neutral-900
text-muted: neutral-500
```

## 30.05.2023 — Прототип на account/page.tsx

Сегодня начал работу над прототипом для страницы аккаунта. Вот основные изменения, которые планирую внести:

1. **Сетка и контейнеры**:
   - Заменить `max-w-6xl mx-auto` на компонент `Container` с токенизированной максимальной шириной
   - Стандартизировать отступы контейнера на всех брейкпоинтах

2. **Типографика**:
   - Заменить `text-2xl font-bold` на компонент `Heading` или токен `typography.h1`
   - Стандартизировать стили текста для меток и значений в карточках

3. **Отступы и ритм**:
   - Заменить `space-y-6` на токены вертикального ритма
   - Стандартизировать отступы внутри карточек

4. **Цвета и темизация**:
   - Обеспечить корректную работу темной темы
   - Использовать семантические цветовые токены вместо прямых цветов

## 31.05.2023 — Компоненты и повторно используемые паттерны

### Избыточность компонентных стилей

Анализируя компоненты ProfileCard и TariffPaymentCard, заметил дублирование стилевых паттернов:

1. Стиль заголовка карточки
2. Стиль метки поля (label)
3. Стиль значения поля (value)
4. Отступы между полями

**Идея решения**: Создать компонентные токены, которые будут повторно использоваться:

```json
"component": {
  "card": {
    "header": {
      "padding": { "value": "{spacing.4.value}" },
      "typography": { "value": "{typography.heading.sm.value}" }
    },
    "content": {
      "padding": { "value": "{spacing.4.value}" },
      "gap": { "value": "{spacing.3.value}" }
    }
  },
  "field": {
    "label": {
      "typography": { "value": "{typography.text.sm.value}" },
      "color": { "value": "{color.text.muted.value}" }
    },
    "value": {
      "typography": { "value": "{typography.text.base.value}" },
      "color": { "value": "{color.text.primary.value}" }
    }
  }
}
```

### Идея типовых компонентов-контейнеров

Для решения проблемы с сетками и отступами, предлагаю создать набор типовых компонентов-контейнеров:

1. **PageContainer** — основной контейнер страницы с максимальной шириной и отступами
2. **Section** — секция страницы с вертикальными отступами
3. **Grid** — настраиваемая сетка с определенным количеством колонок и желобами
4. **Stack** — вертикальный стек элементов с контролируемыми отступами
5. **Cluster** — горизонтальный кластер элементов с контролируемыми отступами

Эти компоненты будут использовать токены для отступов и ширины, обеспечивая единообразие во всем приложении.

## 01.06.2023 — Планирование миграции

### Стратегия постепенного внедрения

Полная миграция на новую систему токенов — большой проект. Предлагаю следующую стратегию:

1. **Подготовительный этап**:
   - Создать полную спецификацию токенов
   - Настроить Style Dictionary
   - Создать документацию и примеры

2. **Пилотная фаза**:
   - Внедрить токены на странице аккаунта
   - Протестировать с реальными пользователями
   - Собрать обратную связь

3. **Постепенная миграция**:
   - Страница за страницей, компонент за компонентом
   - Начать с наиболее проблемных или важных
   - Постоянно документировать изменения

4. **Фаза завершения**:
   - Удалить устаревшие стили
   - Провести окончательное тестирование
   - Обновить документацию

### Управление рисками при миграции

Основные риски и стратегии их смягчения:

1. **Визуальные регрессии**:
   - Делать скриншоты до/после для каждого компонента
   - Использовать visual regression testing

2. **Производительность**:
   - Мониторить размер CSS
   - Следить за количеством CSS-переменных

3. **Кривая обучения**:
   - Создать подробную документацию
   - Провести обучающие сессии для команды

## 02.06.2023 — Интеграция UI-guidelines-v1 в систему токенов

Сегодня изучил документ UI-guidelines-v1.md, который содержит подробные рекомендации по созданию высококачественного интерфейса. Этот документ станет основой для определения конкретных значений в нашей системе токенов.

### Ключевые принципы для системы токенов

Из гайдлайнов извлек следующие измеримые параметры, которые нужно реализовать в системе токенов:

1. **Типографика**:
   - Не более 2-3 семей шрифтов
   - Строго выстроенная система размеров (базовый размер 16px с масштабированием 1.5 или 2)
   - Фиксированные межстрочные интервалы (1.5-1.6)

2. **Пространственные отношения**:
   - Модульная сетка с шагом, кратным 4 или 8 пикселям
   - Внутренние отступы (padding) примерно 70-80% от внешних (margin)
   - Обеспечение единообразия отступов для всех компонентов

3. **Цветовая палитра**:
   - Следование правилу 60-30-10 (60% - основной фон, 30% - брендовый цвет, 10% - акцентный)
   - Обеспечение контрастности согласно WCAG AA/AAA
   - Структурированная система оттенков для каждого базового цвета

4. **Интерактивные элементы**:
   - Единый стиль для кнопок и интерактивных элементов
   - Четко определенные состояния (hover, active, disabled)
   - Согласованные радиусы скругления и тени

### План имплементации гайдлайнов в токенах

На основе этих рекомендаций структура токенов будет включать:

```
tokens/
  ├── base/
  │   ├── typography.json  // Базовые размеры, линии, шрифты
  │   ├── spacing.json     // Модульная сетка 4/8px
  │   ├── color.json       // Базовая палитра с оттенками
  │   └── radius.json      // Стандартные радиусы скругления
  ├── semantic/
  │   ├── typography.json  // H1-H6, текстовые стили
  │   ├── spacing.json     // Отступы section, block, element
  │   ├── color.json       // Семантические цвета (primary, secondary, accent)
  │   └── elevation.json   // Тени и эффекты высоты
  └── component/
      ├── button.json      // Стили кнопок
      ├── card.json        // Стили карточек
      ├── input.json       // Стили полей ввода
      └── ...
```

Важно обеспечить, чтобы система токенов поддерживала измеримые критерии качества, указанные в гайдлайнах:
- Все отступы кратны 4px или 8px
- Размеры шрифтов следуют модульной шкале
- Цвета обеспечивают достаточную контрастность
- Элементы интерфейса имеют согласованный внешний вид

## 03.06.2023 — Завершение подготовительного этапа

Сегодня завершил работу над подготовительным контрактом (TD-PREP-001). Основные результаты:

### 1. Формальный аудит CSS-переменных

Создал полный реестр токенов `token-audit-registry.md`, в котором документированы:
- Все существующие CSS-переменные из `app/globals.css` и `styles/globals.css`
- Проблемы с дублированием переменных и несогласованностью значений
- Планируемое соответствие в новой системе токенов
- Анализ используемых отступов и сеток
- Наиболее часто используемые Tailwind-классы
- Рекомендации по миграции

### 2. Прототип системы токенов

Разработал прототип определений токенов в файле `token-prototype-definitions.md`:
- Трехуровневая структура токенов (базовые, семантические, компонентные)
- Детальные определения токенов для всех категорий (цвета, типографика, отступы и т.д.)
- Специфические токены для компонентов страницы аккаунта:
  - ProfileCard
  - TariffPaymentCard
  - EditProfileModal
  - AccountSelectorDropdown
- Примеры применения токенов к компонентам

### 3. План миграции

Разработал детальный план миграции `token-migration-plan.md`, включающий:
- Подготовительные шаги с настройкой Style Dictionary
- Пилотное внедрение на странице аккаунта
- График поэтапной миграции всех компонентов
- Стратегии тестирования и валидации
- План отката в случае проблем
- Документацию и обучение для команды

### 4. Соответствие UI-guidelines

Особое внимание уделил соответствию системы токенов требованиям UI-guidelines-v1:
- Ограниченная система типографики с последовательной шкалой
- Модульная сетка с шагом 8px
- Соблюдение пропорций 60-30-10 для цветов
- Единообразный стиль интерактивных элементов

### Следующие шаги

1. Настройка инфраструктуры Style Dictionary
2. Создание базовых JSON-файлов с токенами
3. Интеграция с Tailwind CSS
4. Рефакторинг пилотных компонентов

Теперь проект полностью готов к переходу к реализации контракта TD-IMP-001 (Infrastructure Setup).

## 2023-06-02: Создание семантических токенов и настройка тем

Сегодня мы завершили работу над контрактом TD-IMP-003, который фокусировался на создании семантических токенов и настройке темизации интерфейса.

### Ключевые достижения:

1. **Создание семантических токенов**:
   - Разработаны семантические токены для светлой и темной тем
   - Все токены ссылаются на базовые токены, создавая уровень абстракции
   - Категоризация токенов по смысловым группам (фон, текст, границы, т.д.)

2. **Настройка поддержки тем**:
   - Интеграция библиотеки next-themes
   - Создание компонента ThemeProvider
   - Реализация переключателя тем

3. **Улучшение инфраструктуры дизайн-токенов**:
   - Обновлена конфигурация Style Dictionary для поддержки тем
   - Добавлены скрипты для сборки токенов в package.json
   - Настроен режим watch для автоматической пересборки при изменениях

### Преимущества нашего подхода:

1. **Гибкая архитектура**: Семантические токены абстрагируют значения от конкретных цветов и размеров, что делает систему более гибкой.

2. **Поддержка тем**: Система обеспечивает плавное переключение между светлой и темной темами.

3. **Адаптивность**: Токены могут быть использованы для различных компонентов и контекстов.

4. **Удобство разработки**: Переиспользование токенов упрощает разработку и обеспечивает консистентность.

### Дальнейшие шаги:

1. **Компонентные токены**: Создание специфичных для компонентов токенов на основе семантических
2. **Интеграция с Tailwind**: Настройка плагина для использования токенов в Tailwind
3. **Документация в Storybook**: Создание страниц для демонстрации токенов

### Тестирование и валидация:

При разработке семантических токенов мы провели:
- Визуальное тестирование светлой и темной тем
- Проверку правильности ссылок на базовые токены
- Тестирование компонента переключения тем

### Скриншоты:

![Light Theme Preview]() _(будет добавлено при интеграции с компонентами)_
![Dark Theme Preview]() _(будет добавлено при интеграции с компонентами)_

## Отслеживание статуса интеграции

Для наглядности и упрощения управления процессом внедрения токенов, мы вводим систему маркеров непосредственно в коде компонентов. В начале каждого файла `.tsx` компонента добавляется специальный комментарий:

```typescript
// @token-status: [СТАТУС] ([ДЕТАЛИ])
```

Возможные статусы:
*   `COMPLETED`: Интеграция завершена (явно или неявно через Tailwind).
*   `PENDING`: Требуется рефакторинг (например, используются старые переменные).
*   `NEEDS_REVIEW`: Требуется проверка (особенно для кастомных компонентов).
*   `NA`: Не применимо.

Детализация в скобках помогает понять способ интеграции или причину статуса (например, `(Implicit via Tailwind)`, `(Uses legacy vars)`).

Это соглашение позволяет легко отслеживать прогресс и находить компоненты, требующие внимания, с помощью поиска по кодовой базе.

*Важно: Маркеры `@token-status` не применяются к файлам историй Storybook (`*.stories.tsx`), так как они лишь демонстрируют компоненты, статус которых отслеживается в их собственных файлах.*

---

*Блог будет обновляться по мере продвижения проекта...*

## 02.06.2023 — Уточнение структуры макета страницы

После первоначальной стандартизации контейнера (`LYT-CNTR-001-v1`) возникло требование реализовать более распространенный паттерн шапки сайта:

1.  **"Уши шапки":** Фон компонента `TopNavBlock` должен визуально выходить за пределы основного контентного блока, потенциально занимая большую часть ширины экрана (но с боковыми отступами).
2.  **"Красная линия":** Содержимое шапки (логотип, ссылки, иконки) должно быть выровнено по вертикальным границам основного контентного "стакана" (`max-w-6xl mx-auto px-*`), который располагается ниже шапки.

Это потребовало пересмотра подхода:

*   **`TopNavBlock`:** Теперь имеет внешнюю обертку для фона и "ушей" (с `px-*`) и внутреннюю обертку с `max-w-6xl mx-auto` для выравнивания содержимого.
*   **Страницы:** `TopNavBlock` и основной контент (`<main>` или аналогичный `div`) теперь находятся на одном уровне в DOM, а не вложены в общий контейнер `max-w-6xl`. Ограничение `max-w-6xl mx-auto px-*` применяется к контейнеру *основного* контента.

Эти изменения зафиксированы в обновленном контракте `LYT-CNTR-001-v2`.

Следующим шагом будет рефакторинг страницы генератора тестов (`app/page.tsx`) для использования стандартизированных токенов отступов (`TOK-SPC-001`) внутри её сложной структуры.

3. **Интеграция с Tailwind**: Настройка плагина для использования токенов в Tailwind
    *   **Обновление 02.05.2025:** Выявлено несоответствие имен переменных, генерируемых Style Dictionary, и ожидаемых `tailwind.config.ts`. Потребуется создать кастомный форматтер Style Dictionary. См. контракт **TD-FMT-001**.
4. **Документация в Storybook**: Создание страниц для демонстрации токенов 