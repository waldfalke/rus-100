# Feature Contract: USR-001 User Profile Page

**Version:** 1.0
**Date:** 2025-04-30
**Author:** Gemini 2.5 Pro & User

## 1. Overview

**ID:** USR-001
**Name:** User Profile Page
**Description:** Страница для просмотра и управления информацией профиля пользователя, его тарифами и опциями оплаты. Функционал и отображение зависят от роли пользователя (Обычный пользователь или Администратор).
**Target Users:**
  - Обычный пользователь (учитель)
  - Администратор

## 2. Data Structure

Ожидаемая структура данных для страницы:

```typescript
// Опция оплаты
interface PaymentOption {
  id: string; // Уникальный ID опции
  label: string; // Текст ссылки (напр., "Оплатить на месяц, до 16.05.2025")
  cost: number; // Стоимость в рублях (напр., 3000)
  url?: string; // URL для перехода к оплате (пока заглушка '#')
}

// Описание тарифа
interface Tariff {
  id: string; // Уникальный ID тарифа
  name: string; // Короткое название/описание (напр., "от 1 до 15 учеников")
  costPerPeriod: number; // Стоимость за период (напр., 3000)
  periodDescription?: string; // Полное описание стоимости (напр., "за 3000р.")
  studentLimit: number; // Максимальное количество учеников
}

// Данные профиля пользователя
interface UserProfileData {
  // --- Метаданные для отображения ---
  isCurrentUserAdmin: boolean; // Является ли текущий залогиненный пользователь админом?
  isAdminView: boolean; // Просматривает ли админ чужой профиль? (Может быть true только если isCurrentUserAdmin true)
  availableUsers?: { id: string; name: string }[]; // Список пользователей для выбора админом
  selectedUserId?: string; // ID пользователя, чей профиль просматривает админ

  // --- Данные отображаемого профиля ---
  profileUserId: string; // ID пользователя, чей профиль отображается
  profileUserName: string; // Имя пользователя (напр., "Светлана Юрьевна А")
  profileUserEmail: string; // Email пользователя (напр., "anisovasu@mail.ru")
  registrationDate: string; // Дата регистрации (напр., "10.01.2025")
  paidUntilDate: string; // Дата, до которой оплачен доступ (напр., "16.02.2025")
  currentStudentCount: number; // Текущее количество учеников (напр., 14)

  currentTariff?: Tariff; // Текущий тариф пользователя (может быть undefined?)
  nextTariff?: Tariff; // Следующий доступный тариф (может отсутствовать)

  // Опции оплаты, соответствующие ТЕКУЩЕМУ тарифу пользователя
  paymentOptions: PaymentOption[]; 
}
```
*Начальная реализация будет использовать статичные моковые данные, соответствующие этой структуре.*

## 3. Page Structure and Layout

Страница использует стандартный хедер и футер приложения. Основной контент располагается в двух карточках.

**Общая структура:**

1.  **Заголовок (H1):**
    *   Пользователь: "Мой профиль"
    *   Администратор: "Профили пользователей"
2.  **Селектор пользователя (только для Админа):**
    *   Расположен справа вверху, под основным хедером.
    *   Выпадающий список с именами пользователей.
3.  **Карточка "Профиль Пользователя":**
    *   Отображает основную информацию о пользователе.
4.  **Карточка "Тариф и Оплата":**
    *   Отображает информацию о текущем статусе оплаты, тарифах и доступных опциях оплаты.

**Верстка:** Карточки располагаются вертикально с отступами между ними (стиль швейцарской верстки). Используется Tailwind CSS.

## 4. Component Breakdown

### 4.1 Existing Components to Use

*   **Layout:** Стандартный layout приложения с хедером (`TopNavBlock`?) и, возможно, футером.
*   **Card (`@/components/ui/card`):** Базовый контейнер для `ProfileCard` и `TariffPaymentCard`. Используются `Card`, `CardHeader`, `CardTitle`, `CardContent`, `CardFooter` (если необходимо).
*   **Button (`@/components/ui/button`):**
    *   Для ссылок "Оплатить" (с вариантом `variant="link"` и кастомными стилями для цвета `text-teal-600`).
    *   Для кнопок в модальном окне (`Сохранить`, `Отмена`).
*   **Icons (`lucide-react`):**
    *   `Edit3` или `Pencil`: Иконка редактирования рядом с именем и email.
    *   `ChevronDown`: Иконка для дропдауна выбора пользователя.
*   **DropdownMenu / Select (`@/components/ui/dropdown-menu` / `@/components/ui/select`):** Для реализации `AccountSelectorDropdown` (админ). `Select` может быть предпочтительнее для отображения выбранного значения.
*   **Dialog (`@/components/ui/dialog`):** Основа для модального окна `EditProfileModal`. Используются `Dialog`, `DialogTrigger`, `DialogContent`, `DialogHeader`, `DialogTitle`, `DialogDescription`, `DialogFooter`, `DialogClose`.
*   **Input (`@/components/ui/input`):** Поля ввода для имени и email в модальном окне.
*   **Label (`@/components/ui/label`):** Метки для полей ввода в модальном окне.
*   **Text Styles (Tailwind):** Используются существующие классы для размеров шрифтов (`text-xl`, `text-lg`, `text-sm`, `text-xs`), насыщенности (`font-semibold`), цветов (`text-gray-800`, `text-gray-600`, `text-teal-600`) и отступов (`p-4`, `mb-2`, `gap-2` и т.д.), определенные в глобальных стилях и теме.

### 4.2 New Components to Develop

*   **`AccountPage` (`app/account/page.tsx`):**
    *   **Ответственность:** Основной компонент страницы, получает данные (пока моковые), управляет состоянием (например, видимостью модального окна, выбранным пользователем для админа), рендерит заголовок, селектор и карточки в зависимости от роли.
*   **`AccountSelectorDropdown` (Admin only):**
    *   **Ответственность:** Компонент-обертка над `Select` или `DropdownMenu` для отображения списка пользователей и выбора одного из них админом. Принимает список `availableUsers` и `selectedUserId`, возвращает `userId` выбранного пользователя через callback.
    *   **Расположение:** `components/feature/AccountSelectorDropdown.tsx` (или `components/admin/AccountSelectorDropdown.tsx`).
    *   **Примечание:** Можно переиспользовать или адаптировать существующий код из компонентов выпадающих списков, использованных в генераторе тестов (например, `SelectionDropdown`).
*   **`ProfileCard`:**
    *   **Ответственность:** Отображение информации о пользователе (Имя, Email, Дата рег., Кол-во учеников) внутри `Card`. Включает иконки редактирования. Принимает часть `UserProfileData` как props.
    *   **Расположение:** `components/feature/ProfileCard.tsx`.
*   **`EditProfileModal`:**
    *   **Ответственность:** Содержимое модального окна (`DialogContent`) для редактирования имени и email. Включает `Label`, `Input`, `Button`. Принимает текущие имя/email, возвращает обновленные данные через callback при сохранении.
    *   **Расположение:** `components/feature/EditProfileModal.tsx`.
*   **`TariffPaymentCard`:**
    *   **Ответственность:** Отображение информации о статусе оплаты, тарифах и опциях оплаты внутри `Card`. Принимает часть `UserProfileData` как props. Рендерит ссылки "Оплатить".
    *   **Расположение:** `components/feature/TariffPaymentCard.tsx`.

## 5. Styling and Theming

*   Используется **Tailwind CSS** и существующие настроенные токены (цвета, шрифты, отступы, скругления).
*   **Карточки:** Чистый, минималистичный стиль ("швейцарский"). Отступы между карточками (`mb-4` или `mb-6`). Внутренние отступы в карточках (`p-4`, `p-6`).
*   **Типографика:** Использовать установленные размеры шрифтов (`text-xl` для заголовка карточки, `text-sm` или `text-base` для основного текста, `text-gray-600` для меток).
*   **Количество учеников:** Отобразить как `**X** / Y`, где X - крупнее и жирнее (`text-lg font-semibold`), Y - меньше (`text-sm text-gray-600`).
*   **Ссылки "Оплатить":** Использовать `Button` с `variant="link"`, цвет `text-teal-600`, возможно `hover:underline`.
*   **Иконки редактирования:** Маленькие, размещены справа от соответствующего поля, цвет `text-gray-500`, `hover:text-gray-700`, `cursor-pointer`.

## 6. Interaction and Behavior

*   **Загрузка:** Страница загружает данные (пока моковые) для текущего пользователя или выбранного админом.
*   **Выбор пользователя (Админ):** При выборе пользователя в `AccountSelectorDropdown` компонент `AccountPage` перезагружает данные для `selectedUserId`.
*   **Редактирование Профиля:**
    *   Клик по иконке `Edit` рядом с именем или email открывает `EditProfileModal`.
    *   Модальное окно предзаполняется текущими данными.
    *   При нажатии "Сохранить" вызывается функция-callback (пока просто выводит данные в консоль).
    *   При нажатии "Отмена" или `DialogClose` окно закрывается без сохранения.
*   **Оплата:** Клик по ссылкам "Оплатить" пока никуда не ведет (атрибут `href="#"`).
*   **Роли:**
    *   `AccountPage` проверяет `isCurrentUserAdmin` и `isAdminView` для условного рендеринга `AccountSelectorDropdown` и, возможно, блока оплаты в будущем.
    *   Иконки редактирования отображаются только для своего профиля (пользователь) или для профиля выбранного пользователя (админ).

## 7. Future Considerations

*   Интеграция с API для получения/обновления данных профиля.
*   Реализация логики оплаты (интеграция с платежной системой).
*   Реализация функционала для администратора в блоке оплаты (пометка оплаты, генерация инвойсов).
*   Обработка ошибок (API, форма редактирования).
*   Отображение истории платежей (возможно, в отдельной карточке).
*   Отображение опций оплаты для *следующего* тарифа при его выборе (если будет добавлена такая интерактивность).

## 8. Acceptance Criteria (Phase 1 - Mock Data)

*   Создан роут `/account` и базовая страница `AccountPage`.
*   Создана базовая story `components/stories/AccountPage.stories.tsx` для визуализации страницы в Storybook.
*   Страница корректно отображает моковые данные пользователя согласно макету и роли (Админ/Пользователь).
*   Реализованы компоненты `AccountSelectorDropdown`, `ProfileCard`, `TariffPaymentCard`, `EditProfileModal`.
*   Администратор может выбирать пользователя из дропдауна.
*   Реализовано модальное окно для редактирования Имени и Email (без реального сохранения).
*   Стили страницы соответствуют макету и дизайн-системе.
*   Ссылки "Оплатить" присутствуют как заглушки.
*   Контракт USR-001 утвержден. 