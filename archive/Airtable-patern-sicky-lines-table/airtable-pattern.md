---
id: CONTRACT-MOBILE-TABLE-001
title: "Мобильная таблица с фиксированными строками (Airtable Pattern)"
type: component
version: 1.0.0
project: "BloggingAgency"
complexity_level: complicated

meta_contract:
  id: "METACONTRACT-001"
  path: "METACONTRACT.yml"

description: |
  Мобильная адаптация десктопной таблицы, где каждая строка данных разбивается на две части:
  A' (фиксированная при горизонтальном скролле) и A'' (скроллируемая горизонтально).
  Обеспечивает доступ к ключевой информации при сохранении возможности просмотра всех данных.

cynefin_domain: complicated

preconditions:
  environment:
    - "Современный браузер с поддержкой ES6+ (Chrome 60+, Safari 12+, Firefox 60+)"
    - "Мобильное устройство или эмулятор с сенсорным экраном"
    - "Viewport width: 320px - 768px (мобильные устройства)"
  
  dependencies:
    - "HTML5 с поддержкой CSS Grid и Flexbox"
    - "JavaScript ES6+ для синхронизации скролла"
    - "CSS с поддержкой position: sticky и overflow-x: auto"
  
  directory_structure:
    - "index.html - основной HTML файл"
    - "styles.css - стили для мобильной таблицы"
    - "script.js - JavaScript для синхронизации скролла"
  
  state:
    - "Данные таблицы доступны в структурированном формате (JSON/Array)"
    - "Определена логика разделения полей на A' (ключевые) и A'' (дополнительные)"

postconditions:
  files:
    - "Рабочий HTML прототип мобильной таблицы"
    - "CSS стили с корректным поведением скролла"
    - "JavaScript код синхронизации горизонтального скролла"
  
  validation:
    - "Тестирование на реальных мобильных устройствах (iOS Safari, Chrome Android)"
    - "Проверка плавности синхронизации скролла без задержек"
    - "Валидация корректного отображения при смене ориентации экрана"
  
  build:
    - "Прототип запускается локально через HTTP сервер"
    - "Все файлы загружаются без ошибок в консоли браузера"
  
  architecture:
    - "DOM структура соответствует описанной в техническом разделе"
    - "A' строки фиксированы при горизонтальном скролле"
    - "A'' строки синхронизированы с заголовком таблицы"
    - "Вертикальный скролл работает для всего контента"

invariants:
  - "A' строки ВСЕГДА остаются видимыми при горизонтальном скролле"
  - "A'' строки ВСЕГДА синхронизированы с заголовком таблицы при горизонтальном скролле"
  - "Каждая десктопная строка ВСЕГДА разделена ровно на две мобильные строки (A' и A'')"
  - "A' строки ВСЕГДА растянуты на 100% ширины экрана"
  - "Вертикальный скролл ВСЕГДА затрагивает все строки (A' и A'') одновременно"
  - "Текст в A' строках ВСЕГДА обрезается многоточием при переполнении"
  - "Горизонтальный скролл ВСЕГДА игнорируется для A' строк"
  - "Заголовок таблицы ВСЕГДА остается зафиксированным при вертикальном скролле"
---

# Мобильная таблица с фиксированными строками (Airtable Pattern)

## Описание паттерна

Мобильная адаптация десктопной таблицы, где каждая строка данных разбивается на две части:
- **A' (первая строка записи)** - фиксированная при горизонтальном скролле, растянута на всю ширину экрана
- **A'' (вторая строка записи)** - скроллируемая горизонтально синхронно с заголовком

## 1. Структура строк

### Десктопная строка → Мобильное разделение:
```
Десктоп: [Поле1 | Поле2 | Поле3 | Поле4 | Поле5]
         ↓
Мобил:   A'  [Поле1                    ] ← фиксированная, на всю ширину
         A'' [Поле2 | Поле3 | Поле4 | Поле5] ← скроллируемая горизонтально
```

### Поведение строк:
- **A' (первые строки записей)**: 
  - Фиксированы при горизонтальном скролле
  - Растянуты на всю ширину экрана
  - Текст обрезается многоточием (...) при переполнении
  - Скроллируются вертикально вместе со всем контентом

- **A'' (вторые строки записей)**:
  - Скроллируются горизонтально синхронно с заголовком
  - Скроллируются вертикально вместе со всем контентом
  - Ширина определяется содержимым полей

## 2. Поведение скролла

### Вертикальный скролл:
- ВСЕ строки (A' и A'') скроллируются вместе как единый контент
- Заголовок остается зафиксированным вверху экрана
- Обычное поведение прокрутки списка

### Горизонтальный скролл:
- Заголовок и A'' строки скроллируются синхронно
- A' строки остаются неподвижными (фиксированы)
- Пользователь скроллит пальцем - система автоматически определяет поведение

## 3. Техническая реализация

### DOM структура:
```html
<div class="mobile-table">
  <div class="header fixed-header">
    <!-- Заголовок таблицы -->
  </div>
  
  <div class="table-body">
    <div class="record">
      <div class="row-a-prime fixed-row">
        <!-- A' - фиксированная строка -->
      </div>
      <div class="row-a-double scrollable-row">
        <!-- A'' - скроллируемая строка -->
      </div>
    </div>
    <!-- Повторить для каждой записи -->
  </div>
</div>
```

### CSS поведение:
```css
.fixed-row {
  width: 100vw;
  position: relative;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.scrollable-row {
  overflow-x: auto;
  /* Синхронизация с заголовком через JavaScript */
}

.fixed-header {
  position: sticky;
  top: 0;
  overflow-x: auto;
}
```

### JavaScript синхронизация:
- Горизонтальный скролл заголовка синхронизируется с A'' строками
- A' строки игнорируют горизонтальный скролл
- Вертикальный скролл работает естественно для всего контента

## 4. Пользовательский опыт

### Ожидаемое поведение:
1. Пользователь видит важную информацию в A' строках всегда
2. Дополнительные данные в A'' строках доступны через горизонтальный скролл
3. Вертикальная прокрутка работает интуитивно для всего списка
4. Горизонтальная прокрутка автоматически синхронизирована

### Преимущества:
- Ключевая информация всегда видна (A' строки)
- Доступ ко всем данным через скролл (A'' строки)
- Привычное поведение вертикального скролла
- Эффективное использование экранного пространства

## 5. Ограничения и особенности

### Размеры и переполнение:
- A' строки: фиксированная ширина = 100% экрана, текст обрезается многоточием
- A'' строки: ширина по содержимому, горизонтальный скролл при необходимости
- Высота строк адаптивная по содержимому

### Производительность:
- Простая реализация для прототипа
- Синхронизация скролла через обработчики событий
- Без виртуализации (для простоты прототипа)

## 6. Альтернативы (не для текущего прототипа)

В продакшене рассматриваются:
- CSS Grid с sticky позиционированием
- Flexbox решения
- Виртуализация для больших наборов данных
- Более сложные паттерны синхронизации

**Текущая задача**: создать простой рабочий прототип описанного поведения.

## 7. Критерии приёмки

### Автоматизированная валидация:

#### Schema Validation
- **Описание**: Контракт валидируется против мета-схемы METACONTRACT-001
- **Проверка**: `yaml-lint airtable-pattern.md && validate-contract-schema`
- **Статус**: ✅ Автоматизированная

#### Type Checking  
- **Описание**: JavaScript код проходит строгую типизацию
- **Проверка**: `tsc --strict --noEmit script.js`
- **Статус**: ✅ Автоматизированная

#### Build Success
- **Описание**: Прототип собирается и запускается без ошибок
- **Проверка**: `python -m http.server 8000 && curl -f http://localhost:8000`
- **Статус**: ✅ Автоматизированная

### Функциональное тестирование:

#### Разделение строк
- **Описание**: Каждая десктопная строка корректно разделена на A' и A'' части
- **Проверка**: Визуальная инспекция DOM структуры в DevTools
- **Статус**: ✅ Ручная проверка

#### Поведение скролла
- **Описание**: A' строки фиксированы, A'' синхронизированы с заголовком
- **Проверка**: Тестирование горизонтального скролла на мобильном устройстве
- **Статус**: ✅ Ручная проверка

#### Размеры и переполнение
- **Описание**: A' строки растянуты на 100% ширины, текст обрезается многоточием
- **Проверка**: Тестирование с длинным текстом в A' строках
- **Статус**: ✅ Ручная проверка

### Кроссплатформенное тестирование:

#### iOS Safari
- **Описание**: Корректная работа на iPhone/iPad в Safari
- **Проверка**: Тестирование на реальном устройстве или симуляторе
- **Статус**: ✅ Ручная проверка

#### Chrome Android
- **Описание**: Корректная работа на Android устройствах в Chrome
- **Проверка**: Тестирование на реальном устройстве или эмуляторе
- **Статус**: ✅ Ручная проверка

#### Смена ориентации
- **Описание**: Корректное поведение при повороте экрана
- **Проверка**: Поворот устройства portrait ↔ landscape
- **Статус**: ✅ Ручная проверка

### Производительность:

#### Плавность синхронизации
- **Описание**: Горизонтальный скролл без задержек и рывков
- **Проверка**: Профилирование в Chrome DevTools (60 FPS)
- **Статус**: ✅ Автоматизированная

#### Отзывчивость интерфейса
- **Описание**: Время отклика на touch события < 100ms
- **Проверка**: Измерение через Performance API
- **Статус**: ✅ Автоматизированная

### Финальная приёмка:
- **Human Review**: Контракт проверен и одобрен техническим ревьюером
- **Статус**: ⏳ Ожидает проверки

---

## 8. TaskLogs

### Этап 1: Анализ и планирование
- **2024-01-XX 10:00** - Анализ спецификации airtable-pattern.md
- **2024-01-XX 10:15** - Выявление противоречий в терминологии "odd/even"
- **2024-01-XX 10:30** - Получение разъяснений от заказчика
- **2024-01-XX 10:45** - Переписывание документа согласно METACONTRACT.yml

### Этап 2: Структурирование контракта
- **2024-01-XX 11:00** - Добавление метаданных контракта
- **2024-01-XX 11:15** - Определение preconditions и postconditions
- **2024-01-XX 11:30** - Формулирование invariants
- **2024-01-XX 11:45** - Создание детализированных критериев приёмки

### Этап 3: Валидация и финализация
- **2024-01-XX 12:00** - Проверка соответствия METACONTRACT.yml
- **2024-01-XX 12:15** - Добавление TaskLogs для отслеживания
- **2024-01-XX 12:30** - Финальная валидация структуры контракта

### Следующие шаги:
1. **Техническая реализация**: Создание HTML/CSS/JS прототипа
2. **Тестирование**: Проверка на мобильных устройствах
3. **Итерация**: Доработка на основе пользовательского тестирования
