name: Validate Contracts & Schemas

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: Install dependencies
      working-directory: ./distilled-methodology/scripts
      run: npm install
    
    - name: Validate contracts
      working-directory: ./distilled-methodology/scripts
      run: npm run validate:contracts || echo "Contract validation script not yet implemented"
    
    - name: Validate tokens
      working-directory: ./distilled-methodology/scripts
      run: npm run validate:tokens || echo "Token validation script not yet implemented"
    
    - name: Check for broken links
      run: |
        echo "Checking for common broken link patterns..."
        ! grep -r "](../" . --include="*.md" | grep -v "node_modules" | grep "/rus100/" || (echo "Found rus-100 specific paths!" && exit 1)
    
    - name: Validate structure
      run: |
        echo "Checking required files exist..."
        test -f README.md
        test -f RND-INDEX.md
        test -f CHANGELOG.md
        test -f LICENSE
        test -d Onboarding
        test -d distilled-methodology
        test -d field-manuals/e2e-testing
        echo "Structure valid âœ“"
