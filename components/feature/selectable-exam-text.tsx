"use client";

import React, { useState, useEffect } from "react";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Skeleton } from "@/components/ui/skeleton";

// Data based on FC-001 Selectable Exam Text contract
const prototypeTexts = [
  {
    id: "stroganov",
    title: "М.С. Строганов о судьбе поколения",
    content: `
(1)Судьбу поколения неслучайно сравнивают с белым листом, на котором невидимыми чернилами сделаны особые отметки, да и сама бумага покрыта незаметными для беглого взгляда «водяными знаками». (2)Растут дети, бегают в школу, дерутся и мирятся, ходят в технические кружки и на танцы, влюбляются и строят планы, не подозревая, что Судьба вносит за годом год строчки в их общую биографию. (3)Приходит срок, наступает их час –и внезапно в целом поколении обнаруживаются неведомые силы, способные противостоять любым испытаниям, вынести нечеловеческие нагрузки и победить любого врага.

(4)Жизнь  — это путь. (5)Для того, кто хочет пройти его в угоду себе, он тёмен и неведом, ненадёжен, как игрушка в руках безрассудной фортуны. (6)Но для того, кто жизнь видит в служении своей Отчизне, этот путь наполнен особенным, непостижимым для прочих смыслом. (7)К общей цели его ведёт сама Россия.

(8)Её живая душа станет верной советчицей в сомнениях, надёжной попутчицей в долгих странствиях, нежной утешительницей в горе, трудолюбивой помощницей в деяниях, мужественной соратницей в борьбе и битве.

(9)Судьба великих сынов России всегда была открыта и ясна, потому что она кровно связана с судьбой народа, и биография каждого героя всегда совпадает с биографией его страны. (10)Самой жизнью уготовано им жить одной судьбой, разделять со страной её радость и скорбь. (11)Вместе победить и, если потребуется, не торгуясь, отдать за её победу свою жизнь.

(12)«Я патриот, а к патриотам грязь не пристанет»,  — повторял Николай Кузнецов, легендарный разведчик, герой Советского Союза, сын «раскулаченных», с лихвой хлебнувший «от перегибов» в политике партии. (13)Русский герой не припоминал нанесённых обид и не предъявлял счетов. (14)Жизнь свою он положил для служения своей стране, защищая её от фашистов, и его «Подвиг разведчика» останется с нами навсегда.

(15)Русская земля сама рождает и закаляет своих защитников, наделяя их особой совестливостью и честью, чтобы представали они перед всем народом, пронося через века образец служения Родине.
(16)Необученные и необстрелянные мальчишки летом 1941 года будут совершать подвиги и являть чудеса героизма не ради карьеры и наград, не ради высокопарных лозунгов и политических доктрин. (17)Они будут стоять насмерть за свои детские дворы, где гоняли в футбол, за чердаки домов, на которых жались друг к другу голубятни, за берег речки и летние каникулы, проведённые в пионерском лагере, за свою школу, в которой день за днём постигали, «что такое хорошо и что такое плохо», за девчонок, с которыми целовались в скверах после выпускного бала… (18)Поэтому они окажутся сильнее любых вражеских «мёртвых голов» и станут непобедимыми. (19)Так дети Гражданской войны станут героями Великой Отечественной…

(20)Война не сломит их, только закалит характер. (21)Много испытавшие в жизни, они как никто будут ценить и понимать чужие чувства, при этом не скрывая своих. (22)Война воспитает в них человечность, научит принимать ответственность на себя, не бояться тяжёлых трудов, не сомневаться в правоте выбранного дела. (23)Сделает из обычных людей Поколение победителей.
`,
  },
  {
    id: "ovchinnikov",
    title: "В. Овчинников о лосе",
    content: `
(1)Я раскрыл ружьё, достал из патронташа два патрона, зарядил оба ствола, закрыл ружьё, приставил его к плечу и стал внимательно оглядывать местность перед собой, хотя прекрасно знал, что охота ещё не началась. (2)Просто я уже опьянел от атмосферы охоты, и мне хотелось хоть что-то делать.

(3)И вдруг я увидел лося. (4)Именно в правой части поляны, там, где его, по мнению моих товарищей, не должно было быть. (5)Он был крупный, тёмно-бурый, с длинными белыми ногами, мощной, широкой грудью и каким-то коротким, почти без шеи туловищем. (6)Деталей я не видел, видел лишь самого лося, стоявшего на опушке леса в насторожённой позе. (7)И его массивную грудь, куда я уже инстинктивно направлял стволы своего ружья. (8)И больше ничего. (9)Все детали, причём до самых мельчайших, у меня всплыли в памяти уже потом, после завершения всех событий. (10)И он, этот лось, потом ещё долго будет стоять перед моими глазами, как на большой картине или на цветном фото, красавец сибирской тайги, которого я так подло и мерзко убил из засады.

(11)Выстрелы прозвучали дуплетом, один за другим. (12)Выстрелы оказались удачными! (13)Я победил! (14)Я не зря съездил на эту охоту! (15)Я стал настоящим охотником! (16)Я вскинул ружьё вверх, заорал что-то бессмысленное и кинулся к лосю.

(17)Я подбежал к нему и замер. (18)Крик мой сразу оборвался, когда я увидел результат своих выстрелов. (19)Меня обуял настоящий ужас и бросило в дрожь. (20)Лось смотрел на меня. (21)Глаза у него были тёмные, большие, продолговатые, как перезрелые сливы, и влажные.

(22)А из уголков глаз вниз по щекам бежала влага, собираясь внизу на волосах щёк, и частыми каплями падала на землю. (23)Лось плакал, глядя на меня – на своего врага, на человека, принёсшего ему смерть.

(24)Мне стало страшно. (25)Я понял, что сделал что-то такое, за что меня простить невозможно. (26)Я совершил поступок, на который человек не имеет права, если он человек. (27)Я перешёл в своём развитии ту самую грань человечности, которая отделяет человека от «нечеловека».

(28)Я смотрел в глаза лося и был не в силах отвести своего взгляда. (29)Я смотрел в его глаза и чувствовал себя настоящей «нелюдью», самым страшным и самым подлым мерзавцем на свете. (30)Я убил этого короля тайги, этого красавца из засады, убил жестоко, подло, мелко.

(31)Зачем? (32)Для чего?

(33)В сторожку я шёл молча, мне было не по себе. (34)Плачущие глаза лося так и стояли передо мной…

(35)После этого случая я охотиться перестал. (36)Перестал совсем. (37)Не смог больше стрелять в живых существ. (38)Даже в птицу не смог, не говоря уж о чём-то серьёзном. (39)Хотя с ружьём не расставался никогда. (40)Оно и сейчас висит у меня на ковре в идеальном состоянии. (41)Даже патроны дома есть. (42)Но из него я больше не стрелял.
`,
  },
  {
    id: "kataev",
    title: "В.П. Катаев о поэзии",
    content: `
Обливаясь по́том и все время кашляя, я прочитал ему свои стихи. Он сделал томным, красивым голосом избалованного женщинами известного писателя несколько вялых замечаний, а потом разошелся, и, когда я спрятал свою рукопись, он, несколько юмористически сверкнув глазами, погладив кисточку своей серебряной бородки, сказал сладостно-кондитерским голосом:

– Ну уж, так и быть. Теперь моя очередь. Держитесь, Валя. Сейчас я вас убью. – С этими словами он вынул из письменного стола толстую сафьяновую тетрадь и один за другим стал с упоением читать сонеты, написанные, как он объяснил, вчера во время бессонницы в один присест, залпом: – «Седые пейсы. Острый взгляд. Шейлок. Неровными зубами, торопливо он развязал заветный узелок. Таилось в нем сокровище на диво: жемчужина Персидского залива. Из мрака он на свет ее извлек и сам, гордясь, любуется ревниво…» – и так далее и шикарный конец: «…она живет и дышит, и – о, боже! – я слышу вздох: зачем меня хавас достал со дна для этих жадных глаз!»

Разумеется, я был убит наповал. Вот это настоящий поэт! И с этого дня стал страшным почитателем и учеником Федорова, который вскоре привык ко мне и не без томности говорил знакомым:

– Это Валя. Молодой поэт. Мой талантливый ученик. Мы читаем друг другу стихи.

Эта идиллия продолжалась довольно долго, но закончилась как-то вдруг, когда в один прекрасный день расчувствовавшийся Федоров томно сказал:

– Ах, Валя… Все это, откровенно говоря, вздор. Хотя мой учитель Майков и считал меня самым талантливым своим учеником и предсказывал мне блестящую будущность, – при этом Федоров посмотрел на фотографию старика с черно-серебряной бородой, в строгих железных очках – поэта Майкова – с автографом, – но, по совести, какие мы с вами поэты? Бунин – вот кто настоящий поэт. Вы читали Бунина?

– Нет.

– Вы не знаете стихов Бунина? – ужаснулся Федоров. – И ничего о нем не слышали?

– Смутно, – соврал я. – В каком-то журнале. Длинно и скучно. Даже, кажется, без рифм. Впрочем, кажется, это был не Бунин.

Федоров с молчаливым укором посмотрел на меня, подошел к громадному, во всю стену, книжному шкафу, вытянул с полки книгу и стал ее перелистывать.

Мелькнула дарственная надпись с большой – прописной клинописной буквой «Б».

– «Все море – как жемчужное зерцало, – читал Федоров, держа в руках открытую книгу, но не глядя в нее; читал своим красивым, несколько актерским тенорком, дрожащим от неподдельного восхищения. – Сирень с отливом млечно-золотым. И как тепло перед закатом стало, и как душист над саклей тонкий дым! Вон чайка села в бухточке скалистой… – Тут Федоров, повернув свою небольшую скульптурную голову, посмотрел в окно, в черноморскую даль, слегка прищурившись, с таким вниманием, словно и впрямь видел Кавказское побережье с саклей, эту самую скалистую бухточку и чайку, сидевшую в ней. – Вон чайка села в бухточке скалистой, как поплавок… Взлетает иногда – и видно, как струею серебристой сбегает с лапок розовых вода».

Я был поражен. Передо мной вдруг открылась совсем простая тайна поэзии, которая до сих пор так упорно ускользала от меня, приводя в отчаяние.

Я уже давно – хотя и смутно – понимал, что уметь составлять стихи еще не значит быть поэтом. Легкость версификации уже перестала обманывать меня. Внешний вид стихотворений, так отличавшийся от прозы, со своими отдельными четверостишиями, особым щегольством типографской верстки, с тремя звездочками, многоточиями и другими общеизвестными ухищрениями хотя и продолжал оказывать на меня гипнотическое действие, но временами уже начинал раздражать. У меня даже зародилась глупейшая мысль, что можно в маленькую ученическую тетрадку «для слов» записать попарно все существующие рифмы, затем вызубрить, как таблицу умножения, все существующие стихотворные размеры – ямбы, хореи, амфибрахии, – что, в общем, не составляло большого труда, – и дело в шляпе! Что же касается самого содержания, то оно общеизвестно и вполне доступно: мечты, грезы, печаль, тоска, любовь, сад, луна, река, свиданье, страсть, цветы, осень, весна, зима, реже лето, поцелуй, ночь, утро, вечер, реже полдень, измена, горькая судьбина… Мало ли чего! Разумеется, в большом количестве море, волны, заливы, бури, чайки, – но все это вообще. Даже очень может быть бухта. Но бухта вообще. Не подлинная, а книжная. Не вызывающая никаких особенно ясных представлений.

Но тут была, во-первых, не бухта, а бухточка и, во-вторых, не вообще бухточка, а скалистая, то есть такая, какую я много раз видел где-нибудь в Аркадии или на Малом Фонтане и любовался ею, никак не предполагая, что именно она и есть предмет поэзии. Чайка была тоже не абстрактная чайка книжных виньеток и концовок, а вполне реальная черноморская чайка – подруга большефонтанского маяка, – в данном случае севшая в скалистой бухточке, как поплавок, – сравнение, буквально сразившее меня своей простотой и почти научной точностью: уж я ли не знал, как плавает в морской воде двухцветный, наполовину красный и наполовину синий, пробковый поплавок – такой легкий, устойчиво покачивающийся на прибрежной волне, с торчащим кончиком гусиного пера.

Бунин открыл мне глаза на физическое явление поплавка, имеющего – по-видимому! – такой же удельный вес, как и чайка со своими полыми костями и плотным, но чрезвычайно легким, просаленным, непромокаемым опереньем, как бы пропитанным воздухом.

Вода, серебристой струею сбегающая с розовых, тоже непромокаемых лапок, была так достоверна, – теперь бы я сказал: стереоскопична, – словно я издали смотрел на нее в хороший морской бинокль, увеличивающий раз в пятнадцать.

Я увидел чудо подлинной поэзии: передо мной открылся новый мир. В тот же вечер я попросил папу купить мне книгу стихотворений Бунина. Отец посмотрел на меня сквозь пенсне глазами, на которые – по-моему – навернулись слезы умиления: наконец его оболтус взялся за ум. Он просит купить ему не коньки, не футбольный мяч, не духовой пистолет, не теннисную ракетку, а книгу. И не «Шерлока Холмса» Конан Дойля, не «Тайну желтой комнаты» Гастона Леру, а прекрасную книгу русского поэта. Быть может, это был единственный подлинно счастливый день в его жизни. Отцы это поймут. А дети тоже поймут. Но не теперь, а со временем.
`,
  },
];

interface SelectableExamTextProps {
  // Props if needed later, e.g., list of texts, initial selection
}

export const SelectableExamText: React.FC<SelectableExamTextProps> = () => {
  const [selectedTextId, setSelectedTextId] = useState<string>(prototypeTexts[0].id);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    // Имитируем загрузку данных
    const loadData = async () => {
      try {
        setIsLoading(true);
        // Проверяем наличие данных
        if (!prototypeTexts || prototypeTexts.length === 0) {
          throw new Error('Тексты не найдены');
        }
        // Имитируем задержку загрузки
        await new Promise(resolve => setTimeout(resolve, 500));
        setIsLoading(false);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Произошла ошибка при загрузке текстов');
        setIsLoading(false);
      }
    };

    loadData();
  }, []);

  const selectedText = prototypeTexts.find((text) => text.id === selectedTextId);

  const handleValueChange = (value: string) => {
    setSelectedTextId(value);
  };

  if (isLoading) {
    return (
      <Card className="w-full">
        <CardHeader>
          <div className="flex justify-between items-center">
            <Skeleton className="h-8 w-[200px]" />
            <Skeleton className="h-10 w-[280px]" />
          </div>
          <Skeleton className="h-4 w-[300px] mt-2" />
        </CardHeader>
        <CardContent>
          <Skeleton className="h-[400px] w-full" />
        </CardContent>
      </Card>
    );
  }

  if (error) {
    return (
      <Card className="w-full">
        <CardHeader>
          <CardTitle className="text-red-600">Ошибка</CardTitle>
          <CardDescription>{error}</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex justify-center items-center h-[400px] text-red-500">
            Не удалось загрузить тексты. Пожалуйста, обновите страницу.
          </div>
        </CardContent>
      </Card>
    );
  }

  return (
    <Card className="w-full">
      <CardHeader>
        <div className="flex justify-between items-center">
          <CardTitle>{selectedText?.title || "Выберите текст"}</CardTitle>
          <Select onValueChange={handleValueChange} defaultValue={selectedTextId}>
            <SelectTrigger className="w-[280px]">
              <SelectValue placeholder="Выбрать текст..." />
            </SelectTrigger>
            <SelectContent>
              {prototypeTexts.map((text) => (
                <SelectItem key={text.id} value={text.id}>
                  {text.title}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        <CardDescription>
          Текст для выполнения заданий ЕГЭ
        </CardDescription>
      </CardHeader>
      <CardContent>
        <ScrollArea className="h-[300px] w-full rounded-md border p-4 whitespace-pre-line bg-white text-base">
          {selectedText?.content || "Текст не выбран."}
        </ScrollArea>
      </CardContent>
    </Card>
  );
};

export default SelectableExamText; 